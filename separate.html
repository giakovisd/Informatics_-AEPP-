<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Î Î¯Î½Î±ÎºÎ±</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            --array-item-bg: #3b82f6;
            --array-item-text: #ffffff;
            --compare-color: #f59e0b;
            --flyer-bg: #ea580c;
            --border-color: #cbd5e1;
            --arrow-color: #dc2626; /* ÎšÎŸÎšÎšÎ™ÎÎŸ Î’Î•Î›Î‘ÎšÎ™ Î Î‘ÎÎ¤ÎŸÎ¥ */
            --disabled-btn: #94a3b8;
        }

        body.dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --panel-bg: #1e293b;
            --highlight-line: #475569;
            --array-item-bg: #2563eb;
            --border-color: #334155;
            --arrow-color: #f87171;
            --disabled-btn: #475569;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            box-sizing: border-box;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; }
        .controls-area { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        button {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        button.primary { background-color: var(--array-item-bg); color: white; border: none; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); color: #ccc; cursor: not-allowed; }

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-left: 10px; }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            height: calc(100% - 70px);
            box-sizing: border-box;
        }

        /* LEFT: Code Panel */
        .col-code {
            flex: 0 0 400px;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .col-code.hidden { display: none; }

        .tabs { display: flex; border-bottom: 1px solid var(--border-color); background: #f1f5f9; }
        .tab {
            flex: 1; text-align: center; padding: 12px; font-size: 0.9rem;
            border-bottom: 3px solid transparent; color: #64748b; font-weight: bold; background: #f1f5f9; cursor: pointer;
        }
        .tab.active { background: var(--panel-bg); border-bottom-color: var(--array-item-bg); color: var(--text-color); }

        .problem-info {
            background-color: #fff9c4; /* Î‘Ï€Î±Î»ÏŒ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ */
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        .info-header { font-weight: bold; display: block; margin-bottom: 5px; color: #b45309; }

        .code-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .code-line { padding: 2px 6px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); color: #000; font-weight: bold; }

        /* CENTER: Visualization */
        .col-viz {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
        }

        .narrative {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(59, 130, 246, 0.08);
            border-left: 4px solid var(--array-item-bg);
            font-size: 0.95rem;
            font-style: italic;
            min-height: 24px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .arrays-wrapper {
            flex: 1;
            display: flex;
            justify-content: space-around; /* Space out the 3 arrays */
            overflow-y: auto; 
            align-items: flex-start;
            padding-top: 10px;
            padding-bottom: 40px; 
            padding-left: 60px; /* Space for pointers on the left */
        }

        .array-col { display: flex; flex-direction: column; align-items: center; position: relative; width: 140px;}
        
        .array-header { 
            font-weight: bold; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            font-size: 1rem; 
            color: var(--text-color); 
            text-align: center;
        }

        .cell-wrapper {
            position: relative;
            height: 42px; 
            width: 100%;
            margin-bottom: 8px; 
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: var(--array-item-bg);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            font-size: 0.95rem;
            box-sizing: border-box;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }

        .cell-idx { position: absolute; left: -25px; font-size: 0.8rem; color: var(--text-color); opacity: 0.7; font-weight: bold; top: 12px; }
        .hidden-slot { opacity: 0.15; background: #94a3b8; border: 1px dashed #64748b; }
        .highlight-check { transform: scale(1.1); background-color: var(--compare-color) !important; z-index: 5; transition: transform 0.2s; }

        /* --- POINTERS --- */
        .pointer-track {
            position: absolute;
            left: -130px; 
            top: 40px; 
            width: 100px;
            height: 100%;
            pointer-events: none;
        }
        
        .sliding-pointer {
            position: absolute;
            top: 0;
            right: 0;
            height: 42px; 
            display: flex;
            align-items: center; 
            justify-content: flex-end;
            gap: 5px;
            transition: top 0.4s cubic-bezier(0.25, 1, 0.5, 1); /* Smooth transition */
            opacity: 1;
        }

        .pointer-arrow-symbol { font-size: 1.8rem; color: var(--arrow-color); line-height: 0; font-weight: bold; padding-bottom: 4px; }
        .pointer-label { font-size: 1.3rem; font-weight: bold; color: var(--arrow-color); font-family: monospace; }

        /* --- FLYING ELEMENT --- */
        .flying-cell {
            position: fixed;
            z-index: 9999;
            background-color: var(--flyer-bg);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        /* RIGHT: Output */
        .col-output {
            flex: 0 0 220px;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .output-header { padding: 10px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); }
        .output-log { flex: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 3px 0; }
        
        .col-code.hidden { display: none; }
    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏÎ½ (Î†ÏÏ„Î¹Î¿Î¹ / Î ÎµÏÎ¹Ï„Ï„Î¿Î¯)</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="resetSim()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        <button onclick="play()" id="btnPlay" class="primary">â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
        <button onclick="step()" id="btnStep">Î’Î®Î¼Î± â©</button>
        <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±</button>
        
        <div class="slider-container">
            <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
            <input type="range" min="50" max="1500" value="800" id="speedSlider" oninput="updateSpeed()">
        </div>

        <button onclick="toggleTheme()" id="btnTheme">ğŸŒ™</button>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code">
        <div class="tabs">
            <div class="tab active" onclick="setSolution(1)">1. ÎœÎ¯Î± Î£Î¬ÏÏ‰ÏƒÎ· (Î‘Ï€Î»Î®)</div>
            <div class="tab" onclick="setSolution(2)">2. Î”ÏÎ¿ Î£Î±ÏÏÏƒÎµÎ¹Ï‚</div>
        </div>

        <div class="problem-info">
            <span class="info-header">Î”ÎµÎ´Î¿Î¼Î­Î½Î±: A[12] Î¼Îµ Î¸ÎµÏ„Î¹ÎºÎ¿ÏÏ‚ Î±ÎºÎ­ÏÎ±Î¹Î¿Ï…Ï‚</span>
            Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€Î¯Î½Î±ÎºÎ± Î’ Î¼Îµ Ï„Î¿Ï…Ï‚ Î†ÏÏ„Î¹Î¿Ï…Ï‚ ÎºÎ±Î¹ Î“ Î¼Îµ Ï„Î¿Ï…Ï‚ Î ÎµÏÎ¹Ï„Ï„Î¿ÏÏ‚ Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚ Ï„Î¿Ï… Î‘.
        </div>

        <div class="code-content" id="codeContainer"></div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">ÎˆÏ„Î¿Î¹Î¼Î¿ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...</div>
        
        <div class="arrays-wrapper" id="arraysContainer">
            </div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- Data ---
    //const NUMBERS = [12, 7, 5, 20, 8, 15, 3, 10, 44, 9, 2, 11];
    let NUMBERS = []; // Î¤Î¿ ÎºÎ¬Î½Î¿Ï…Î¼Îµ let Î³Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î»Î»Î¬Î¶ÎµÎ¹
    const CODES = {
        1: [
            "Îº â† 0",
            "Î» â† 0",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼ÎµÏ‡ÏÎ¹ 12",
            "  Î±Î½ Î‘[Î¹] MOD 2 = 0 Ï„Î¿Ï„Îµ",
            "    Îº â† Îº + 1",
            "    Î’[Îº] â† Î‘[Î¹]",
            "  Î±Î»Î»Î¹Ï‰Ï‚",
            "    Î» â† Î» + 1",
            "    Î“[Î»] â† Î‘[Î¹]",
            "  Ï„ÎµÎ»Î¿Ï‚_Î±Î½",
            "Ï„Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î±Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼Î­Ï‡ÏÎ¹ Îº",
            "  Î“ÏÎ¬ÏˆÎµ Î’[Î¹]",
            "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼Î­Ï‡ÏÎ¹ Î»",
            "  Î“ÏÎ¬ÏˆÎµ Î“[Î¹]",
            "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ],
        2: [
            "Îº â† 0",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼ÎµÏ‡ÏÎ¹ 12",
            "  Î±Î½ Î‘[Î¹] MOD 2 = 0 Ï„Î¿Ï„Îµ",
            "    Îº â† Îº + 1",
            "    Î’[Îº] â† Î‘[Î¹]",
            "  Î¤Î­Î»Î¿Ï‚_Î±Î½",
            "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î» â† 0",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼ÎµÏ‡ÏÎ¹ 12",
            "  Î±Î½ Î‘[Î¹] MOD 2 = 1 Ï„Î¿Ï„Îµ",
            "    Î» â† Î» + 1",
            "    Î“[Î»] â† Î‘[Î¹]",
            "  Ï„ÎµÎ»Î¿Ï‚_Î±Î½",
            "Ï„Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î±Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼Î­Ï‡ÏÎ¹ Îº",
            "  Î“ÏÎ¬ÏˆÎµ Î’[Î¹]",
            "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± Î¹ Î±Ï€Î¿ 1 Î¼Î­Ï‡ÏÎ¹ Î»",
            "  Î“ÏÎ¬ÏˆÎµ Î“[Î¹]",
            "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ]
    };

    // --- State ---
    let currentSol = 1;
    let data = { A: [], B: [], C: [] };
    let steps = [];
    let stepIdx = -1;
    let timer = null;
    let isPlaying = false;
    let isAnimating = false;
    let speed = 800;

    const STEP_HEIGHT = 50; 
    const HEADER_OFFSET = -50; 

    // --- Init ---
    function init() {
        NUMBERS = Array.from({length: 12}, () => Math.floor(Math.random() * 50) + 1);
        data.A = [...NUMBERS];
        data.B = new Array(12).fill(null); 
        data.C = new Array(12).fill(null); 
        
        renderCode();
        renderBaseArrays();
        calcSteps();
        
        updatePointers(-1, -1, -1);
    }

    function setSolution(n) {
        currentSol = n;
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i+1 === n));
        resetSim();
    }

    function resetSim() {
        isPlaying = false;
        isAnimating = false;
        clearTimeout(timer);
        stepIdx = -1;
        document.getElementById('outputLog').innerHTML = '';
        document.getElementById('narrativeBox').innerText = "ÎˆÏ„Î¿Î¹Î¼Î¿...";
        document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.flying-cell').forEach(e => e.remove());
        
        init();
    }

    // --- Rendering ---
    function renderCode() {
        const html = CODES[currentSol].map((l, i) => 
            `<div class="code-line" id="line-${i}">
                <span style="color:#888; margin-right:8px; user-select:none;">${i+1}</span>
                ${l.replace(/ /g, '&nbsp;')}
             </div>`
        ).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function renderBaseArrays() {
        const con = document.getElementById('arraysContainer');
        let html = '';

        // Array A
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î‘</div>
                    <div class="pointer-track">
                        <div id="ptr-i" class="sliding-pointer" style="top: ${HEADER_OFFSET}px;">
                            <span class="pointer-label">i</span>
                            <span class="pointer-arrow-symbol">â¡</span>
                        </div>
                    </div>`;
        data.A.forEach((v, i) => html += createCell('A', i, v));
        html += `</div>`;

        // Array B
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î’ (Î†ÏÏ„Î¹Î¿Î¹)</div>
                    <div class="pointer-track">
                        <div id="ptr-k" class="sliding-pointer" style="top: ${HEADER_OFFSET}px;">
                            <span class="pointer-label">Îº</span>
                            <span class="pointer-arrow-symbol">â¡</span>
                        </div>
                    </div>`;
        for(let i=0; i<12; i++) html += createCell('B', i, '', '', true);
        html += `</div>`;

        // Array C (Gamma)
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î“ (Î ÎµÏÎ¹Ï„Ï„Î¿Î¯)</div>
                    <div class="pointer-track">
                        <div id="ptr-l" class="sliding-pointer" style="top: ${HEADER_OFFSET}px;">
                            <span class="pointer-label">Î»</span>
                            <span class="pointer-arrow-symbol">â¡</span>
                        </div>
                    </div>`;
        for(let i=0; i<12; i++) html += createCell('C', i, '', '', true);
        html += `</div>`;

        con.innerHTML = html;
    }

    function createCell(arr, idx, val, extraStyle='', isEmpty=false) {
        const cls = isEmpty ? 'cell hidden-slot' : 'cell';
        return `
            <div class="cell-wrapper" id="wrap-${arr}-${idx}">
                <div id="c-${arr}-${idx}" class="${cls}" style="${extraStyle}">
                    <span class="cell-idx">${idx+1}</span>
                    <span class="cell-val">${val}</span>
                </div>
            </div>
        `;
    }

    // --- Logic ---
    function calcSteps() {
        steps = [];
        let k = 0;
        let l = 0;

        if(currentSol === 1) {
            // -- SOLUTION 1: SINGLE PASS --
            steps.push({ line: 0, type: 'info', msg: 'Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·: Îº â† 0', i: -1, k: 0, l: 0 });
            steps.push({ line: 1, type: 'info', msg: 'Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·: Î» â† 0', i: -1, k: 0, l: 0 });

            for (let i = 0; i < 12; i++) {
                steps.push({ line: 2, type: 'loop', msg: `Î•Ï€Î±Î½Î¬Î»Î·ÏˆÎ· Î³Î¹Î± Î¹ = ${i+1}`, i: i, k: k, l: l });
                
                let isEven = (NUMBERS[i] % 2 === 0);
                steps.push({ 
                    line: 3, type: 'cmp', 
                    msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: ${NUMBERS[i]} MOD 2 = 0; (${isEven ? 'ÎÎ‘Î™' : 'ÎŸÎ§Î™'})`, 
                    i: i, k: k, l: l 
                });

                if (isEven) {
                    k++;
                    steps.push({ line: 4, type: 'calc', msg: `Î†ÏÏ„Î¹Î¿Ï‚. Î¤Î¿ Îº Î±Ï…Î¾Î¬Î½ÎµÏ„Î±Î¹ ÏƒÎµ ${k}`, i: i, k: k, l: l });
                    steps.push({ 
                        line: 5, type: 'copy_anim', 
                        srcIdx: i, destArr: 'B', destIdx: k-1, val: NUMBERS[i], 
                        msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… ${NUMBERS[i]} ÏƒÏ„Î¿Î½ Î’[${k}]`,
                        i: i, k: k, l: l
                    });
                } else {
                    l++;
                    steps.push({ line: 7, type: 'calc', msg: `Î ÎµÏÎ¹Ï„Ï„ÏŒÏ‚. Î¤Î¿ Î» Î±Ï…Î¾Î¬Î½ÎµÏ„Î±Î¹ ÏƒÎµ ${l}`, i: i, k: k, l: l });
                    steps.push({ 
                        line: 8, type: 'copy_anim', 
                        srcIdx: i, destArr: 'C', destIdx: l-1, val: NUMBERS[i], 
                        msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… ${NUMBERS[i]} ÏƒÏ„Î¿Î½ Î“[${l}]`,
                        i: i, k: k, l: l
                    });
                }
                steps.push({ line: 10, type: 'end_if', msg: 'Î¤Î­Î»Î¿Ï‚ Î‘Î½', i: i, k: k, l: l });
            }

            // Print Loops
            for (let j = 0; j < k; j++) {
                // Pass k=j+1 directly to map visual pointer to correct row
                steps.push({ line: 11, type: 'print_loop_B', msg: `Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î’[${j+1}]`, i: -1, k: j+1, l: -1, val: data.A.filter(x=>x%2===0)[j] });
                steps.push({ line: 12, type: 'print', val: data.A.filter(x=>x%2===0)[j], msg: `Î“ÏÎ¬ÏˆÎµ: ${data.A.filter(x=>x%2===0)[j]}`, i:-1, k: j+1, l: -1 });
            }
            for (let j = 0; j < l; j++) {
                steps.push({ line: 14, type: 'print_loop_C', msg: `Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î“[${j+1}]`, i: -1, k: -1, l: j+1, val: data.A.filter(x=>x%2!==0)[j] });
                steps.push({ line: 15, type: 'print', val: data.A.filter(x=>x%2!==0)[j], msg: `Î“ÏÎ¬ÏˆÎµ: ${data.A.filter(x=>x%2!==0)[j]}`, i: -1, k: -1, l: j+1 });
            }

        } else {
            // -- SOLUTION 2: DOUBLE PASS --
            steps.push({ line: 0, type: 'info', msg: 'Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·: Îº â† 0', i: -1, k: 0, l: 0 });
            
            // Pass 1: Evens
            for (let i = 0; i < 12; i++) {
                steps.push({ line: 1, type: 'loop', msg: `1Î· Î£Î¬ÏÏ‰ÏƒÎ·: Î¹ = ${i+1}`, i: i, k: k, l: l });
                let isEven = (NUMBERS[i] % 2 === 0);
                steps.push({ line: 2, type: 'cmp', msg: `Î•Î¯Î½Î±Î¹ Ï„Î¿ ${NUMBERS[i]} Î†ÏÏ„Î¹Î¿Ï‚;`, i: i, k: k, l: l });
                
                if(isEven) {
                    k++;
                    steps.push({ line: 3, type: 'calc', msg: `ÎÎ±Î¹. Îº = ${k}`, i: i, k: k, l: l });
                    steps.push({ 
                        line: 4, type: 'copy_anim', 
                        srcIdx: i, destArr: 'B', destIdx: k-1, val: NUMBERS[i], 
                        msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿Î½ Î’[${k}]`,
                        i: i, k: k, l: l
                    });
                }
            }

            steps.push({ line: 7, type: 'info', msg: 'Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·: Î» â† 0', i: -1, k: k, l: 0 });

            // Pass 2: Odds
            for (let i = 0; i < 12; i++) {
                steps.push({ line: 8, type: 'loop', msg: `2Î· Î£Î¬ÏÏ‰ÏƒÎ·: Î¹ = ${i+1}`, i: i, k: k, l: l });
                let isOdd = (NUMBERS[i] % 2 !== 0);
                steps.push({ line: 9, type: 'cmp', msg: `Î•Î¯Î½Î±Î¹ Ï„Î¿ ${NUMBERS[i]} Î ÎµÏÎ¹Ï„Ï„ÏŒÏ‚;`, i: i, k: k, l: l });
                
                if(isOdd) {
                    l++;
                    steps.push({ line: 10, type: 'calc', msg: `ÎÎ±Î¹. Î» = ${l}`, i: i, k: k, l: l });
                    steps.push({ 
                        line: 11, type: 'copy_anim', 
                        srcIdx: i, destArr: 'C', destIdx: l-1, val: NUMBERS[i], 
                        msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿Î½ Î“[${l}]`,
                        i: i, k: k, l: l
                    });
                }
            }

            // Print Loops
            for (let j = 0; j < k; j++) {
                steps.push({ line: 15, type: 'print_loop_B', msg: `Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î’[${j+1}]`, i: -1, k: j+1, l: -1 });
                steps.push({ line: 16, type: 'print', val: data.A.filter(x=>x%2===0)[j], msg: `Î“ÏÎ¬ÏˆÎµ Î’[${j+1}]`, i: -1, k: j+1, l: -1 });
            }
            for (let j = 0; j < l; j++) {
                steps.push({ line: 18, type: 'print_loop_C', msg: `Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î“[${j+1}]`, i: -1, k: -1, l: j+1 });
                steps.push({ line: 19, type: 'print', val: data.A.filter(x=>x%2!==0)[j], msg: `Î“ÏÎ¬ÏˆÎµ Î“[${j+1}]`, i: -1, k: -1, l: j+1 });
            }
        }
    }

    // --- Pointers Logic ---
    function updatePointers(i, k, l) {
        const ptrI = document.getElementById('ptr-i');
        const ptrK = document.getElementById('ptr-k');
        const ptrL = document.getElementById('ptr-l');

        // Logic for i
        if (i >= 0) {
            ptrI.style.top = (i * STEP_HEIGHT) + 'px';
            ptrI.style.opacity = '1';
        } else {
            ptrI.style.opacity = '0'; // Hide instead of reset to header
        }

        // Logic for k (Array B)
        if (k > 0) {
            ptrK.style.top = ((k - 1) * STEP_HEIGHT) + 'px';
            ptrK.style.opacity = '1';
        } else {
            ptrK.style.opacity = '0'; // Hide
        }

        // Logic for l (Array C)
        if (l > 0) {
            ptrL.style.top = ((l - 1) * STEP_HEIGHT) + 'px';
            ptrL.style.opacity = '1';
        } else {
            ptrL.style.opacity = '0'; // Hide
        }
    }

    // --- Animation Logic ---
    function flyElement(srcIdx, destArr, destIdx, val, callback) {
        const srcEl = document.getElementById(`c-A-${srcIdx}`);
        const destWrap = document.getElementById(`wrap-${destArr}-${destIdx}`);
        
        srcEl.scrollIntoView({behavior: "smooth", block: "center"});

        setTimeout(() => {
            const r1 = srcEl.getBoundingClientRect();
            const r2 = destWrap.getBoundingClientRect();

            const flyer = document.createElement('div');
            flyer.className = 'flying-cell';
            flyer.innerText = val;
            flyer.style.width = r1.width + 'px';
            flyer.style.height = r1.height + 'px';
            flyer.style.left = r1.left + 'px';
            flyer.style.top = r1.top + 'px';
            
            document.body.appendChild(flyer);

            flyer.getBoundingClientRect(); // reflow

            const dur = speed * 0.8; 
            flyer.style.transition = `all ${dur}ms ease-in-out`;
            flyer.style.left = r2.left + 'px';
            flyer.style.top = r2.top + 'px';

            setTimeout(() => {
                flyer.remove();
                callback();
            }, dur + 50);
        }, 100);
    }

    // --- Execution ---
    function step() {
        if (isAnimating) return; 
        if (stepIdx >= steps.length - 1) {
            isPlaying = false;
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
            return;
        }

        stepIdx++;
        runStep(steps[stepIdx]);
    }

    function runStep(s) {
        // --- POINTER LABEL & VISIBILITY LOGIC ---
        const lblK = document.querySelector('#ptr-k .pointer-label');
        const lblL = document.querySelector('#ptr-l .pointer-label');
        
        // Default labels
        lblK.innerText = 'Îº';
        lblL.innerText = 'Î»';

        // Swap to 'i' ONLY during print phases
        if (s.type === 'print_loop_B' || (s.type === 'print' && s.k > 0)) {
            lblK.innerText = 'Î¹';
        }
        if (s.type === 'print_loop_C' || (s.type === 'print' && s.l > 0)) {
            lblL.innerText = 'Î¹';
        }
        // -----------------------------------------

        document.querySelectorAll('.code-line').forEach(e => e.classList.remove('active'));
        const lineEl = document.getElementById(`line-${s.line}`);
        if(lineEl) {
            lineEl.classList.add('active');
            lineEl.scrollIntoView({behavior:"smooth", block:"center"});
        }

        document.getElementById('narrativeBox').innerText = s.msg;
        document.querySelectorAll('.highlight-check').forEach(e => e.classList.remove('highlight-check'));

        // Update Pointers Position
        updatePointers(s.i, s.k, s.l);

        if (s.type === 'cmp') {
            document.getElementById(`c-A-${s.i}`).classList.add('highlight-check');
        }
        else if (s.type === 'copy_anim') {
            isAnimating = true;
            toggleControls(false);

            flyElement(s.srcIdx, s.destArr, s.destIdx, s.val, () => {
                updateCell(s.destArr, s.destIdx, s.val);
                isAnimating = false;
                toggleControls(true);
                if (isPlaying) timer = setTimeout(step, speed * 0.2);
            });
            return; 
        }
        else if (s.type === 'print') {
            const log = document.getElementById('outputLog');
            log.innerHTML += `<div class="log-item">${s.val}</div>`;
            log.scrollTop = log.scrollHeight;
            
            // Highlight the cell being printed
            if (s.k > 0) document.getElementById(`wrap-B-${s.k-1}`).classList.add('highlight-check');
            if (s.l > 0) document.getElementById(`wrap-C-${s.l-1}`).classList.add('highlight-check');
        }

        if (isPlaying) {
            timer = setTimeout(step, speed);
        }
    }

    function updateCell(arr, idx, val) {
        const el = document.getElementById(`c-${arr}-${idx}`);
        el.querySelector('.cell-val').innerText = val;
        el.classList.remove('hidden-slot');
    }

    function toggleControls(enable) {
        document.getElementById('btnStep').disabled = !enable;
    }

    function play() {
        if (isAnimating) return;
        if (!isPlaying) {
            isPlaying = true;
            document.getElementById('btnPlay').innerText = "â¸ Î Î±ÏÏƒÎ·";
            step();
        } else {
            isPlaying = false;
            clearTimeout(timer);
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        }
    }

    function updateSpeed() {
        speed = 1550 - document.getElementById('speedSlider').value;
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    function toggleCode() {
        const codePanel = document.querySelector('.col-code');
        codePanel.classList.toggle('hidden');
        const btn = document.getElementById('btnCode');
        btn.innerText = codePanel.classList.contains('hidden') ? "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±" : "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }

    init();
</script>
</body>
</html>