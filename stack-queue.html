<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î£Ï„Î¿Î¯Î²Î± ÎºÎ±Î¹ ÎŸÏ…ÏÎ¬</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            
            --col-stack: #3b82f6; 
            --col-queue: #8b5cf6; 
            
            --cell-bg: #ffffff;
            --cell-filled: #dbeafe;
            
            --border-color: #cbd5e1;
            --disabled-btn: #94a3b8;
            
            --ptr-top: #dc2626;   
            --ptr-front: #059669; 
            --ptr-rear: #d97706;  
            --anim-val-bg: #f59e0b; 

            --code-kw: #0000CD; 
            --code-sym: #FF0000; 
            --code-var: #000000; 
            --code-num: #008000;
            --code-str: #A020F0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            box-sizing: border-box;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; }
        .controls-area { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        button {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        button.action-btn { background-color: #fff; border: 2px solid var(--col-stack); color: var(--col-stack); }
        button.action-btn:hover { background-color: var(--col-stack); color: white; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); border-color: var(--disabled-btn); color: #fff; cursor: not-allowed; transform: none; }

        .input-group {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #eff6ff;
            padding: 5px 10px;
            border-radius: 6px;
            border: 1px solid #bfdbfe;
        }
        .input-group input { width: 80px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; text-align:center;}

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-left: 10px; }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            height: calc(100% - 70px);
            box-sizing: border-box;
            overflow: hidden; 
        }

        /* LEFT: Code Panel */
        .col-code {
            flex: 0 0 450px;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        /* Hidden by default */
        .col-code.hidden { display: none; }

        .tabs { display: flex; background: #f1f5f9; border-bottom: 1px solid var(--border-color); }
        .tab {
            flex: 1; text-align: center; padding: 12px; font-size: 0.9rem; cursor: pointer;
            border-bottom: 3px solid transparent; color: #64748b; font-weight: bold;
        }
        .tab:hover { background: #e2e8f0; }
        .tab.active { background: var(--panel-bg); border-bottom-color: var(--col-stack); color: var(--text-color); }

        .code-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            white-space: pre; 
        }
        .code-line { padding: 2px 6px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); font-weight: bold; }

        .kw { color: var(--code-kw); font-weight: bold; } 
        .sym { color: var(--code-sym); font-weight: bold; }
        .var { color: var(--code-var); }
        .num { color: var(--code-num); font-weight: bold; }
        .str { color: var(--code-str); }

        /* CENTER: Visualization */
        .col-viz {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
            overflow: hidden; 
        }

        .narrative {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(59, 130, 246, 0.1); 
            border-left: 4px solid var(--col-stack);
            font-size: 0.95rem;
            font-style: italic;
            min-height: 24px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .vars-box {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fff;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            width: 120px;
            z-index: 50;
        }
        .var-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: monospace;
            font-size: 0.9rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 2px;
        }
        .var-val { font-weight: bold; color: var(--col-stack); }

        .scene-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: auto;
            background-color: #f8fafc;
        }

        /* STACK (Vertical) */
        .stack-container {
            display: flex;
            flex-direction: column-reverse; 
            gap: 2px;
            position: relative;
            padding-left: 60px; 
            margin-top: 50px; 
        }

        /* QUEUE (Horizontal) */
        .queue-container {
            display: grid;
            grid-template-columns: repeat(10, 60px);
            gap: 2px;
            position: relative;
            padding-top: 60px; 
            padding-bottom: 60px;
            margin-left: 60px;
            margin-right: 60px;
        }

        /* Array Cell */
        .cell {
            width: 60px;
            height: 44px; 
            background-color: var(--cell-bg);
            border: 2px solid #94a3b8;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s;
        }
        .cell.filled { background-color: var(--cell-filled); border-color: var(--col-stack); }
        
        .cell-content {
            font-weight: bold;
            font-size: 1.1rem;
            z-index: 2;
        }

        .idx-lbl {
            position: absolute;
            font-size: 0.75rem;
            color: #64748b;
            font-family: monospace;
            z-index: 5; 
        }
        .stack-container .idx-lbl { right: 2px; top: 2px; }
        .queue-container .idx-lbl { right: 2px; bottom: 2px; }

        /* POINTERS */
        .pointer {
            position: absolute;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease-out;
            white-space: nowrap;
            z-index: 10;
        }
        
        /* Stack Top Pointer */
        .ptr-top {
            color: var(--ptr-top);
            left: -15px; 
            height: 44px; 
            line-height: 44px;
            display: flex;
            align-items: center;
        }
        .ptr-top::after { content: 'â¡'; font-size: 1.8rem; margin-left: 5px; line-height: 1;}

        /* Queue Front Pointer */
        .ptr-front {
            color: var(--ptr-front);
            top: -5px; 
            flex-direction: column;
            width: 60px; justify-content: center;
        }
        .ptr-front::after { content: 'â¬‡'; font-size: 1.5rem; margin-top: -5px; }

        /* Queue Rear Pointer */
        .ptr-rear {
            color: var(--ptr-rear);
            bottom: -5px; 
            flex-direction: column-reverse;
            width: 60px; justify-content: center;
        }
        .ptr-rear::after { content: 'â¬†'; font-size: 1.5rem; margin-bottom: -5px; }

        /* --- ANIMATING VALUE --- */
        .animating-val {
            position: fixed; 
            width: 56px; 
            height: 40px; 
            background-color: var(--anim-val-bg);
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            z-index: 9999; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        /* RIGHT: Output */
        .col-output {
            flex: 0 0 200px;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .output-header { padding: 10px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); }
        .output-log { flex: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.9rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 3px 0; }
        .log-error { color: #dc2626; font-weight: bold; }

    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Î”Î¿Î¼Î­Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½: Î£Ï„Î¿Î¯Î²Î± & ÎŸÏ…ÏÎ¬</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="init()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        
        <div id="stackControls" class="input-group">
            <input type="text" id="stackInput" placeholder="Î¤Î¹Î¼Î®">
            <button class="action-btn" onclick="runOp('push')">ÎÎ¸Î·ÏƒÎ·</button>
            <button class="action-btn" onclick="runOp('pop')">Î‘Ï€ÏÎ¸Î·ÏƒÎ·</button>
        </div>

        <div id="queueControls" class="input-group" style="display:none;">
            <input type="text" id="queueInput" placeholder="Î¤Î¹Î¼Î®">
            <button class="action-btn" onclick="runOp('enqueue')">Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®</button>
            <button class="action-btn" onclick="runOp('dequeue')">Î•Î¾Î±Î³Ï‰Î³Î®</button>
        </div>

        <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±</button>

        <div class="slider-container">
            <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
            <input type="range" min="500" max="5000" value="2000" id="speedSlider" oninput="updateSpeed()">
        </div>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code hidden">
        <div class="tabs">
            <div class="tab active" onclick="setMode(1)">Î£Ï„Î¿Î¯Î²Î± (Stack)</div>
            <div class="tab" onclick="setMode(2)">ÎŸÏ…ÏÎ¬ (Queue)</div>
        </div>
        <div class="code-content" id="codeContainer"></div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±...</div>
        
        <div class="vars-box" id="varsBox"></div>

        <div class="scene-wrapper" id="sceneWrapper"></div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- State ---
    let currentMode = 1; 
    const SIZE = 10;
    let arr = new Array(SIZE).fill(null);
    
    let topPtr = 0;
    let frontPtr = 0;
    let rearPtr = 0;

    let isBusy = false;
    let speed = 3000;

    // --- Helpers ---
    function kw(t) { return `<span class="kw">${t}</span>`; }
    function sym(t) { return `<span class="sym">${t}</span>`; }
    function v(t) { return `<span class="var">${t}</span>`; }
    function n(t) { return `<span class="num">${t}</span>`; }
    function str(t) { return `<span class="str">${t}</span>`; }
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    // --- Toggle Code ---
    function toggleCode() {
        const p = document.querySelector('.col-code');
        p.classList.toggle('hidden');
        const btn = document.getElementById('btnCode');
        btn.innerText = p.classList.contains('hidden') ? "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±" : "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }

    // --- Codes ---
    function getCodes(op) {
        const stackPush = [
            `${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î”ÏÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ Î³Î¹Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®:'")}`,
            `${kw("Î”Î™Î‘Î’Î‘Î£Î•")} ${v("ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿")}`,
            `${kw("Î‘Î")} ${v("top")} ${sym("<")} ${n("10")} ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${v("top")} ${sym("<-")} ${v("top")} ${sym("+")} ${n("1")}`,
            `  ${v("A")}${sym("[")}${v("top")}${sym("]")} ${sym("<-")} ${v("ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î¥Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ· ÏƒÏ„Î¿Î¯Î²Î±Ï‚'")}`,
            `${kw("Î¤Î•Î›ÎŸÎ£_Î‘Î")}`
        ];
        const stackPop = [
            `${kw("Î‘Î")} ${v("top")} ${sym(">=")} ${n("1")} ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${v("A")}${sym("[")}${v("top")}${sym("]")}`,
            `  ${v("top")} ${sym("<-")} ${v("top")} ${sym("-")} ${n("1")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î¥Ï€Î¿Ï‡ÎµÎ¯Î»Î¹ÏƒÎ· ÏƒÏ„Î¿Î¯Î²Î±Ï‚'")}`,
            `${kw("Î¤Î•Î›ÎŸÎ£_Î‘Î")}`
        ];
        const queueEnq = [
            `${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î”ÏÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿:'")}`,
            `${kw("Î”Î™Î‘Î’Î‘Î£Î•")} ${v("ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿")}`,
            `${kw("Î‘Î")} ${v("rear")} ${sym("=")} ${n("10")} ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î“ÎµÎ¼Î¬Ï„Î· Î¿Ï…ÏÎ¬'")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£_Î‘Î")} (${v("front")} ${sym("=")} ${n("0")} ${kw("ÎšÎ‘Î™")} ${v("rear")} ${sym("=")} ${n("0")}) ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${v("front")} ${sym("<-")} ${n("1")}`,
            `  ${v("rear")} ${sym("<-")} ${n("1")}`,
            `  ${v("A")}${sym("[")}${v("rear")}${sym("]")} ${sym("<-")} ${v("ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£")}`,
            `  ${v("rear")} ${sym("<-")} ${v("rear")} ${sym("+")} ${n("1")}`,
            `  ${v("A")}${sym("[")}${v("rear")}${sym("]")} ${sym("<-")} ${v("ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿")}`,
            `${kw("Î¤Î•Î›ÎŸÎ£_Î‘Î")}`
        ];
        const queueDeq = [
            `${kw("Î‘Î")} (${v("front")} ${sym("=")} ${n("0")} ${kw("ÎšÎ‘Î™")} ${v("rear")} ${sym("=")} ${n("0")}) ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î†Î´ÎµÎ¹Î± Î¿Ï…ÏÎ¬'")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£_Î‘Î")} (${v("front")} ${sym("=")} ${v("rear")}) ${kw("Î¤ÎŸÎ¤Î•")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î•Î¾Î¬Î³ÎµÏ„Î±Î¹: '")}${sym(",")} ${v("A")}${sym("[")}${v("front")}${sym("]")}`,
            `  ${v("front")} ${sym("<-")} ${n("0")}`,
            `  ${v("rear")} ${sym("<-")} ${n("0")}`,
            `${kw("Î‘Î›Î›Î™Î©Î£")}`,
            `  ${kw("Î“Î¡Î‘Î¨Î•")} ${str("'Î•Î¾Î¬Î³ÎµÏ„Î±Î¹: '")}${sym(",")} ${v("A")}${sym("[")}${v("front")}${sym("]")}`,
            `  ${v("front")} ${sym("<-")} ${v("front")} ${sym("+")} ${n("1")}`,
            `${kw("Î¤Î•Î›ÎŸÎ£_Î‘Î")}`
        ];

        if(op === 'push') return stackPush;
        if(op === 'pop') return stackPop;
        if(op === 'enqueue') return queueEnq;
        if(op === 'dequeue') return queueDeq;
        return [];
    }

    // --- Init ---
    function init() {
        arr = new Array(SIZE).fill(null);
        topPtr = 0;
        frontPtr = 0;
        rearPtr = 0;
        isBusy = false;
        
        document.getElementById('outputLog').innerHTML = '';
        document.getElementById('narrativeBox').innerText = "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±...";
        
        renderScene();
        updateVars();
        renderCode(currentMode === 1 ? 'push' : 'enqueue');
        updateSpeed(); 
    }

    function setMode(m) {
        if(isBusy) return;
        currentMode = m;
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i+1 === m));
        
        document.getElementById('stackControls').style.display = m===1 ? 'flex' : 'none';
        document.getElementById('queueControls').style.display = m===2 ? 'flex' : 'none';
        
        const root = document.documentElement;
        if(m===1) {
            root.style.setProperty('--col-stack', '#3b82f6');
            document.querySelector('.tab.active').style.borderBottomColor = '#3b82f6';
        } else {
            root.style.setProperty('--col-stack', '#8b5cf6');
            document.querySelector('.tab.active').style.borderBottomColor = '#8b5cf6';
        }
        init();
    }

    function renderCode(op) {
        const lines = getCodes(op);
        const html = lines.map((l, i) => `<div class="code-line" id="line-${i}">${l}</div>`).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function updateVars() {
        const box = document.getElementById('varsBox');
        if(currentMode === 1) {
            box.innerHTML = `<div class="var-item"><span>top:</span> <span class="var-val">${topPtr}</span></div>`;
        } else {
            box.innerHTML = `
                <div class="var-item"><span>front:</span> <span class="var-val" style="color:var(--ptr-front)">${frontPtr}</span></div>
                <div class="var-item"><span>rear:</span> <span class="var-val" style="color:var(--ptr-rear)">${rearPtr}</span></div>
            `;
        }
    }

    function renderScene() {
        const wrapper = document.getElementById('sceneWrapper');
        wrapper.innerHTML = '';

        if(currentMode === 1) { // STACK
            const container = document.createElement('div');
            container.className = 'stack-container';
            
            for(let i=1; i<=SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                cell.innerHTML = `<span class="idx-lbl">${i}</span><span class="cell-content"></span>`;
                container.appendChild(cell);
            }

            const ptr = document.createElement('div');
            ptr.className = 'pointer ptr-top';
            ptr.id = 'ptr-top';
            ptr.innerText = 'top';
            // 44px + 2px gap = 46px
            ptr.style.bottom = ((topPtr > 0 ? (topPtr - 1) * 46 : -46)) + 'px'; 
            ptr.style.opacity = topPtr === 0 ? '0' : '1';
            
            container.appendChild(ptr);
            wrapper.appendChild(container);

        } else { // QUEUE
            const container = document.createElement('div');
            container.className = 'queue-container';

            for(let i=1; i<=SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                cell.innerHTML = `<span class="idx-lbl">${i}</span><span class="cell-content"></span>`;
                container.appendChild(cell);
            }

            const fPtr = document.createElement('div');
            fPtr.className = 'pointer ptr-front'; fPtr.id = 'ptr-front'; fPtr.innerText = 'F';
            
            const rPtr = document.createElement('div');
            rPtr.className = 'pointer ptr-rear'; rPtr.id = 'ptr-rear'; rPtr.innerText = 'R';

            setQueuePointerPos(fPtr, frontPtr);
            setQueuePointerPos(rPtr, rearPtr);

            container.appendChild(fPtr);
            container.appendChild(rPtr);
            wrapper.appendChild(container);
        }
    }

    function setQueuePointerPos(el, idx) {
        if (idx === 0) {
            el.style.opacity = '0';
        } else {
            el.style.opacity = '1';
            el.style.left = ((idx - 1) * 62) + 'px';
        }
    }

    function updatePointersAnim() {
        if(currentMode === 1) {
            const ptr = document.getElementById('ptr-top');
            // Exact centering logic: 44px height + 2px gap = 46px stride
            ptr.style.bottom = ((topPtr > 0 ? (topPtr - 1) * 46 : -46)) + 'px';
            ptr.style.opacity = topPtr === 0 ? '0' : '1';
        } else {
            const fPtr = document.getElementById('ptr-front');
            const rPtr = document.getElementById('ptr-rear');
            setQueuePointerPos(fPtr, frontPtr);
            setQueuePointerPos(rPtr, rearPtr);
        }
        updateVars();
    }

    function highlightLine(idx) {
        document.querySelectorAll('.code-line').forEach(l => l.classList.remove('active'));
        const el = document.getElementById(`line-${idx}`);
        if(el) el.classList.add('active');
    }

    function log(msg, isError=false) {
        const div = document.createElement('div');
        div.className = 'log-item' + (isError ? ' log-error' : '');
        div.innerText = msg;
        const c = document.getElementById('outputLog');
        c.appendChild(div);
        c.scrollTop = c.scrollHeight;
    }

    function narrate(msg) {
        document.getElementById('narrativeBox').innerText = msg;
    }

    // --- ANIMATIONS ---

    async function animatePush(targetCellId, value) {
        const targetCell = document.getElementById(targetCellId);
        const rect = targetCell.getBoundingClientRect();
        
        const topCell = document.getElementById('cell-10');
        const topRect = topCell.getBoundingClientRect();

        const animEl = document.createElement('div');
        animEl.className = 'animating-val';
        animEl.innerText = value;
        document.body.appendChild(animEl); 

        // Start Above Cell 10
        const startTop = topRect.top - 60; 
        animEl.style.left = `${rect.left + 2}px`;
        animEl.style.top = `${startTop}px`;
        
        void animEl.offsetWidth; 

        // Drop with BRAKING
        animEl.style.transition = `top ${speed*0.9}ms cubic-bezier(0.25, 1, 0.5, 1)`;
        animEl.style.top = `${rect.top + 2}px`;

        await sleep(speed*0.9);

        animEl.remove();
        targetCell.classList.add('filled');
        targetCell.querySelector('.cell-content').innerText = value;
    }

    async function animatePop(sourceCellId) {
        const sourceCell = document.getElementById(sourceCellId);
        const valStr = sourceCell.querySelector('.cell-content').innerText;
        const rect = sourceCell.getBoundingClientRect();
        
        const topCell = document.getElementById('cell-10');
        const topRect = topCell.getBoundingClientRect();

        const animEl = document.createElement('div');
        animEl.className = 'animating-val';
        animEl.innerText = valStr;
        document.body.appendChild(animEl);

        animEl.style.left = `${rect.left + 2}px`;
        animEl.style.top = `${rect.top + 2}px`;

        sourceCell.classList.remove('filled');
        sourceCell.querySelector('.cell-content').innerText = '';

        void animEl.offsetWidth;

        // Launch up
        animEl.style.transition = `all ${speed*0.7}ms ease-in`;
        animEl.style.top = `${topRect.top - 100}px`; 
        animEl.style.opacity = '0';

        await sleep(speed*0.7);
        animEl.remove();
    }

    async function animateEnqueue(targetCellId, value) {
        const targetCell = document.getElementById(targetCellId);
        const rect = targetCell.getBoundingClientRect();
        
        const rightCell = document.getElementById('cell-10');
        const rightRect = rightCell.getBoundingClientRect();

        const animEl = document.createElement('div');
        animEl.className = 'animating-val';
        animEl.innerText = value;
        document.body.appendChild(animEl);

        // Start Right of Cell 10
        animEl.style.left = `${rightRect.right + 20}px`; 
        animEl.style.top = `${rect.top + 2}px`;

        void animEl.offsetWidth;

        // Slide Left with BRAKING
        animEl.style.transition = `left ${speed*0.9}ms cubic-bezier(0.25, 1, 0.5, 1)`;
        animEl.style.left = `${rect.left + 2}px`;

        await sleep(speed*0.9);

        animEl.remove();
        targetCell.classList.add('filled');
        targetCell.querySelector('.cell-content').innerText = value;
    }

    async function animateDequeue(sourceCellId) {
        const sourceCell = document.getElementById(sourceCellId);
        const valStr = sourceCell.querySelector('.cell-content').innerText;
        const rect = sourceCell.getBoundingClientRect();

        const animEl = document.createElement('div');
        animEl.className = 'animating-val';
        animEl.innerText = valStr;
        document.body.appendChild(animEl);

        animEl.style.left = `${rect.left + 2}px`;
        animEl.style.top = `${rect.top + 2}px`;

        sourceCell.classList.remove('filled');
        sourceCell.querySelector('.cell-content').innerText = '';

        void animEl.offsetWidth;

        // Slide Left Out
        animEl.style.transition = `all ${speed*0.6}ms ease-in`;
        animEl.style.left = `${rect.left - 100}px`;
        animEl.style.opacity = '0';

        await sleep(speed*0.6);
        animEl.remove();
    }

    // --- Ops ---

    async function runOp(op) {
        if(isBusy) return;
        isBusy = true;
        renderCode(op); 
        
        let val = '';
        if(op === 'push') val = document.getElementById('stackInput').value.trim();
        if(op === 'enqueue') val = document.getElementById('queueInput').value.trim();

        document.getElementById('stackInput').value = '';
        document.getElementById('queueInput').value = '';

        if(op === 'push') await execPush(val);
        else if(op === 'pop') await execPop();
        else if(op === 'enqueue') await execEnqueue(val);
        else if(op === 'dequeue') await execDequeue();

        document.querySelectorAll('.code-line').forEach(l => l.classList.remove('active'));
        narrate("ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ.");
        isBusy = false;
    }

    async function execPush(val) {
        if(!val) val = Math.floor(Math.random()*90)+10; 
        
        highlightLine(0); narrate("Î“Î¡Î‘Î¨Î• 'Î”ÏÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿...'"); await sleep(speed*0.5);
        highlightLine(1); narrate(`Î”Î™Î‘Î’Î‘Î£Î• ${val}`); await sleep(speed*0.5);
        
        highlightLine(2); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: top(${topPtr}) < 10`); await sleep(speed*0.5);
        if(topPtr < 10) {
            highlightLine(3); 
            topPtr++; 
            updatePointersAnim(); 
            narrate(`top <- top + 1 (${topPtr})`); 
            await sleep(speed*0.8); 

            highlightLine(4);
            narrate(`Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ${val} ÏƒÏ„Î· Î¸Î­ÏƒÎ· ${topPtr}...`);
            await animatePush(`cell-${topPtr}`, val);
            arr[topPtr-1] = val; 
            
        } else {
            highlightLine(5); await sleep(speed*0.3);
            highlightLine(6); 
            log("Î¥Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ· ÏƒÏ„Î¿Î¯Î²Î±Ï‚", true); 
            narrate("Î¥Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ·!");
            await sleep(speed);
        }
        highlightLine(7); 
    }

    async function execPop() {
        highlightLine(0); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: top(${topPtr}) >= 1`); await sleep(speed*0.5);
        
        if(topPtr >= 1) {
            highlightLine(1);
            const val = arr[topPtr-1];
            narrate(`Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿Ï… Î±Ï€ÏŒ Î¸Î­ÏƒÎ· ${topPtr}...`);
            await animatePop(`cell-${topPtr}`);
            arr[topPtr-1] = null; 
            log(`Î•Î¾Î±Î³Ï‰Î³Î®: ${val}`);
            await sleep(speed*0.3);

            highlightLine(2);
            topPtr--;
            updatePointersAnim();
            narrate(`top <- top - 1 (${topPtr})`);
            await sleep(speed*0.8);
        } else {
            highlightLine(3); await sleep(speed*0.3);
            highlightLine(4);
            log("Î¥Ï€Î¿Ï‡ÎµÎ¯Î»Î¹ÏƒÎ· ÏƒÏ„Î¿Î¯Î²Î±Ï‚", true);
            narrate("Î¥Ï€Î¿Ï‡ÎµÎ¯Î»Î¹ÏƒÎ·!");
            await sleep(speed);
        }
        highlightLine(5); 
    }

    async function execEnqueue(val) {
        if(!val) val = Math.floor(Math.random()*90)+10;

        highlightLine(0); narrate("Î“Î¡Î‘Î¨Î• 'Î”ÏÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿...'"); await sleep(speed*0.5);
        highlightLine(1); narrate(`Î”Î™Î‘Î’Î‘Î£Î• ${val}`); await sleep(speed*0.5);

        highlightLine(2); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: rear(${rearPtr}) = 10`); await sleep(speed*0.5);
        if(rearPtr === 10) {
            highlightLine(3);
            log("Î“ÎµÎ¼Î¬Ï„Î· Î¿Ï…ÏÎ¬", true);
            narrate("Î— Î¿Ï…ÏÎ¬ ÎµÎ¯Î½Î±Î¹ Î³ÎµÎ¼Î¬Ï„Î·.");
            await sleep(speed);
        } else {
            highlightLine(4); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: front=0 ÎšÎ‘Î™ rear=0`); await sleep(speed*0.5);
            
            let targetPos = rearPtr + 1;

            if(frontPtr === 0 && rearPtr === 0) {
                // First
                highlightLine(5); frontPtr = 1; updatePointersAnim(); narrate("front <- 1"); await sleep(speed*0.5);
                highlightLine(6); rearPtr = 1; updatePointersAnim(); narrate("rear <- 1"); await sleep(speed*0.8);
                targetPos = 1;

                highlightLine(7);
                narrate(`Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ${val} ÏƒÏ„Î· Î¸Î­ÏƒÎ· ${targetPos}...`);
                await animateEnqueue(`cell-${targetPos}`, val);
                arr[targetPos-1] = val;
            } else {
                highlightLine(8); await sleep(speed*0.3); 
                highlightLine(9); 
                rearPtr++; 
                updatePointersAnim();
                narrate(`rear <- rear + 1 (${rearPtr})`);
                await sleep(speed*0.8);
                targetPos = rearPtr;

                highlightLine(10);
                narrate(`Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ${val} ÏƒÏ„Î· Î¸Î­ÏƒÎ· ${targetPos}...`);
                await animateEnqueue(`cell-${targetPos}`, val);
                arr[targetPos-1] = val;
            }
        }
        highlightLine(11);
    }

    async function execDequeue() {
        highlightLine(0); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: front=0 ÎšÎ‘Î™ rear=0`); await sleep(speed*0.5);
        
        if(frontPtr === 0 && rearPtr === 0) {
            highlightLine(1);
            log("Î†Î´ÎµÎ¹Î± Î¿Ï…ÏÎ¬", true);
            narrate("Î— Î¿Ï…ÏÎ¬ ÎµÎ¯Î½Î±Î¹ Î¬Î´ÎµÎ¹Î±.");
            await sleep(speed);
        } else {
            highlightLine(2); narrate(`ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: front(${frontPtr}) = rear(${rearPtr})`); await sleep(speed*0.5);
            
            const val = arr[frontPtr-1];

            if(frontPtr === rearPtr) {
                // Last
                highlightLine(3);
                narrate(`Î•Î¾Î±Î³Ï‰Î³Î® Î¼Î¿Î½Î±Î´Î¹ÎºÎ¿Ï ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿Ï…...`);
                await animateDequeue(`cell-${frontPtr}`);
                arr[frontPtr-1]=null;
                log(`Î•Î¾Î¬Î³ÎµÏ„Î±Î¹: ${val}`);
                await sleep(speed*0.3);

                highlightLine(4); frontPtr = 0; updatePointersAnim(); narrate("front <- 0"); await sleep(speed*0.5);
                highlightLine(5); rearPtr = 0; updatePointersAnim(); narrate("rear <- 0"); await sleep(speed*0.8);
            } else {
                highlightLine(6); await sleep(speed*0.3); 
                highlightLine(7);
                narrate(`Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿Ï…...`);
                await animateDequeue(`cell-${frontPtr}`);
                arr[frontPtr-1]=null;
                log(`Î•Î¾Î¬Î³ÎµÏ„Î±Î¹: ${val}`);
                await sleep(speed*0.3);

                highlightLine(8);
                frontPtr++;
                updatePointersAnim();
                narrate(`front <- front + 1 (${frontPtr})`);
                await sleep(speed*0.8);
            }
        }
        highlightLine(9);
    }

    function updateSpeed() {
        // Slider Left (500) = Very Slow (Delay 5500ms)
        // Slider Right (5000) = Fast (Delay 1000ms)
        speed = 6000 - document.getElementById('speedSlider').value;
    }

    init();

</script>
</body>
</html>