<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®Ï‚ Ï€Î¹Î½Î¬ÎºÏ‰Î½</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            --array-item-bg: #3b82f6;
            --array-item-text: #ffffff;
            --compare-color: #f59e0b;
            --flyer-bg: #ea580c;
            --border-color: #cbd5e1;
            --arrow-color: #dc2626;
            --disabled-btn: #94a3b8;
        }

        body.dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --panel-bg: #1e293b;
            --highlight-line: #475569;
            --array-item-bg: #2563eb;
            --border-color: #334155;
            --arrow-color: #f87171;
            --disabled-btn: #475569;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            box-sizing: border-box;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; }
        .controls-area { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        button {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        button.primary { background-color: var(--array-item-bg); color: white; border: none; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); color: #ccc; cursor: not-allowed; }

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-left: 10px; }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            height: calc(100% - 70px);
            box-sizing: border-box;
        }

        /* LEFT: Code Panel */
        .col-code {
            flex: 0 0 360px;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .tabs { display: flex; border-bottom: 1px solid var(--border-color); background: #f1f5f9; }
        .tab {
            flex: 1; text-align: center; padding: 12px; font-size: 0.9rem;
            border-bottom: 3px solid var(--array-item-bg); color: var(--text-color); font-weight: bold; background: var(--panel-bg);
        }

        .code-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .code-line { padding: 2px 6px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); color: #000; font-weight: bold; }

        /* CENTER: Visualization */
        .col-viz {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
        }

        .narrative {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(59, 130, 246, 0.08);
            border-left: 4px solid var(--array-item-bg);
            font-size: 0.95rem;
            font-style: italic;
            min-height: 24px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .arrays-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: 220px; /* Î›Î¯Î³Î¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÎºÎµÎ½ÏŒ Î³Î¹Î± Ï„Î± Î²ÎµÎ»Î¬ÎºÎ¹Î± */
            overflow-y: auto; 
            align-items: flex-start;
            padding-top: 10px;
            padding-bottom: 40px; 
            padding-left: 50px; /* Extra padding left for the far left arrow */
        }

        .array-col { display: flex; flex-direction: column; align-items: center; position: relative; }
        
        .array-header { 
            font-weight: bold; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            font-size: 1rem; 
            color: var(--text-color); 
        }

        .cell-wrapper {
            position: relative;
            height: 42px; 
            width: 130px;
            margin-bottom: 8px; 
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: var(--array-item-bg);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            border-radius: 6px;
            font-size: 0.95rem;
            box-sizing: border-box;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .cell-idx { position: absolute; left: -25px; font-size: 0.8rem; color: var(--text-color); opacity: 0.7; font-weight: bold; top: 12px; }
        .hidden-slot { opacity: 0.15; background: #94a3b8; border: 1px dashed #64748b; }
        .highlight-check { transform: scale(1.1); background-color: var(--compare-color) !important; z-index: 5; transition: transform 0.2s; }

        /* --- POINTERS (FIXED ALIGNMENT) --- */
        .pointer-track {
            position: absolute;
            /* Î‘Î›Î›Î‘Î“Î—: ÎœÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ· Ï€Î¿Î»Ï Ï€Î¹Î¿ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ (-130px) Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿Ï…Ï‚ Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚ */
            left: -130px; 
            top: 40px; 
            width: 100px;
            height: 100%;
            pointer-events: none;
        }
        
        .sliding-pointer {
            position: absolute;
            top: 0;
            right: 0;
            height: 42px; 
            display: flex;
            align-items: center; 
            justify-content: flex-end;
            gap: 5px;
            transition: top 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 1;
        }

        .pointer-arrow-symbol { font-size: 1.8rem; color: var(--arrow-color); line-height: 0; font-weight: bold; padding-bottom: 4px; }
        .pointer-label { font-size: 1.3rem; font-weight: bold; color: var(--arrow-color); font-family: monospace; }

        /* --- FLYING ELEMENT --- */
        .flying-cell {
            position: fixed;
            z-index: 9999;
            background-color: var(--flyer-bg);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        /* RIGHT: Output */
        .col-output {
            flex: 0 0 220px;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .output-header { padding: 10px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); }
        .output-log { flex: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 3px 0; }
/* ÎšÎ»Î¬ÏƒÎ· Î³Î¹Î± Î½Î± ÎºÏÏÎ²ÎµÎ¹ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± */
.col-code.hidden {
    display: none;
}
/* Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ†ÏÎ½Î·ÏƒÎ· Ï„Î¿Ï… Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î¿Ï‚ */
.problem-info {
    background-color: #fff9c4; /* Î‘Ï€Î±Î»ÏŒ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ */
    padding: 15px;             /* ÎšÎµÎ½ÏŒ Î³ÏÏÏ‰ Î±Ï€ÏŒ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ */
    border-bottom: 1px solid var(--border-color); /* Î“ÏÎ±Î¼Î¼Î® Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰ */
    color: var(--text-color);  /* Î§ÏÏÎ¼Î± Î³ÏÎ±Î¼Î¼Î¬Ï„Ï‰Î½ */
    font-size: 0.95rem;        /* ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î³ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚ */
    line-height: 1.5;          /* Î”Î¹Î¬ÏƒÏ„Î¹Ï‡Î¿ Î³Î¹Î± ÎµÏ…ÎºÎ¿Î»Î¯Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ */
}

.info-header {
    font-weight: bold;         /* ÎˆÎ½Ï„Î¿Î½Î± Î³ÏÎ¬Î¼Î¼Î±Ï„Î± Î³Î¹Î± Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ "Î”ÎµÎ´Î¿Î¼Î­Î½Î±" */
    display: block;            /* ÎÎ± Ï€Î¹Î¬Î½ÎµÎ¹ Î´Î¹ÎºÎ® Ï„Î¿Ï… Î³ÏÎ±Î¼Î¼Î® */
    margin-bottom: 5px;        /* ÎšÎµÎ½ÏŒ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ */
    color: #b45309;            /* Î£ÎºÎ¿ÏÏÎ¿ Ï€Î¿ÏÏ„Î¿ÎºÎ±Î»Î¯ Î³Î¹Î± Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ */
}   
 </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Ï‰Î½ Î¸ÎµÏ„Î¹ÎºÏÎ½ Î±ÏÎ¹Î¸Î¼ÏÎ½ ÏƒÎµ Î½Î­Î¿ Ï€Î¯Î½Î±ÎºÎ±</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="resetSim()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        <button onclick="play()" id="btnPlay" class="primary">â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
        <button onclick="step()" id="btnStep">Î’Î®Î¼Î± â©</button>
        <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ ÎšÏÎ´Î¹ÎºÎ±Ï‚</button>
        
        <div class="slider-container">
            <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
            <input type="range" min="50" max="1500" value="800" id="speedSlider" oninput="updateSpeed()">
        </div>

        <button onclick="toggleTheme()" id="btnTheme">ğŸŒ™</button>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code">
        <div class="tabs">
            <div class="tab">Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Î±Ï€ÏŒ Î‘ ÏƒÎµ Î’</div>
        </div>

<div class="problem-info" id="problemInfo">
            <span class="info-header">Î”ÎµÎ´Î¿Î¼Î­Î½Î±:A[12], Î±ÎºÎ­ÏÎ±Î¹Ï‰Î½ Î±ÏÎ¹Î¸Î¼ÏÎ½</span>
            <span class="info-text" id="problemText">
                Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Ï‰Î½ Î¸ÎµÏ„Î¹ÎºÏÎ½ Î±ÏÎ¹Î¸Î¼ÏÎ½ ÏƒÎµ Î½Î­Î¿ Ï€Î¯Î½Î±ÎºÎ± ÎºÎ±Î¹ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Î½Î­Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±.
            </span>
        </div>



        <div class="code-content" id="codeContainer"></div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">ÎˆÏ„Î¿Î¹Î¼Î¿ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...</div>
        
        <div class="arrays-wrapper" id="arraysContainer">
            </div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- Data ---
    const NUMBERS = [15, -3, 8, -10, 0, 4, 12, -5, 9, -2, 20, -1];
    
    const CODE = [
        "k â† 0",
        "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 12",
        "  Î‘Î½ Î‘[i] > 0 Ï„ÏŒÏ„Îµ",
        "    k â† k + 1",
        "    Î’[k] â† Î‘[i]",
        "  Î¤Î­Î»Î¿Ï‚_Î±Î½",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ k",
        "  Î“ÏÎ¬ÏˆÎµ Î’[i]",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
    ];

    // --- State ---
    let data = { A: [], B: [] };
    let steps = [];
    let stepIdx = -1;
    let timer = null;
    let isPlaying = false;
    let isAnimating = false;
    let speed = 800;

    const STEP_HEIGHT = 50; 
    const HEADER_OFFSET = -50; 

    // --- Init ---
    function init() {
        data.A = [...NUMBERS];
        data.B = new Array(12).fill(null); 
        
        renderCode();
        renderBaseArrays();
        calcSteps();
        
        updatePointers(-1, -1);
    }

    function resetSim() {
        isPlaying = false;
        isAnimating = false;
        clearTimeout(timer);
        stepIdx = -1;
        document.getElementById('outputLog').innerHTML = '';
        document.getElementById('narrativeBox').innerText = "ÎˆÏ„Î¿Î¹Î¼Î¿...";
        document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.flying-cell').forEach(e => e.remove());
        
        init();
    }

    // --- Rendering ---
    function renderCode() {
        const html = CODE.map((l, i) => 
            `<div class="code-line" id="line-${i}">
                <span style="color:#888; margin-right:8px; user-select:none;">${i+1}</span>
                ${l.replace(/ /g, '&nbsp;')}
             </div>`
        ).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function renderBaseArrays() {
        const con = document.getElementById('arraysContainer');
        let html = '';

        // Array A
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î‘</div>
                    <div class="pointer-track">
                        <div id="ptr-i" class="sliding-pointer" style="top: ${HEADER_OFFSET}px;">
                            <span class="pointer-label">i</span>
                            <span class="pointer-arrow-symbol">â¡</span>
                        </div>
                    </div>`;
        data.A.forEach((v, i) => html += createCell('A', i, v));
        html += `</div>`;

        // Array B
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î’</div>
                    <div class="pointer-track">
                        <div id="ptr-k" class="sliding-pointer" style="top: ${HEADER_OFFSET}px;">
                            <span class="pointer-label">Îº</span>
                            <span class="pointer-arrow-symbol">â¡</span>
                        </div>
                    </div>`;
        for(let i=0; i<12; i++) html += createCell('B', i, '', '', true);
        html += `</div>`;

        con.innerHTML = html;
    }

    function createCell(arr, idx, val, extraStyle='', isEmpty=false) {
        const cls = isEmpty ? 'cell hidden-slot' : 'cell';
        return `
            <div class="cell-wrapper" id="wrap-${arr}-${idx}">
                <div id="c-${arr}-${idx}" class="${cls}" style="${extraStyle}">
                    <span class="cell-idx">${idx+1}</span>
                    <span class="cell-val">${val}</span>
                </div>
            </div>
        `;
    }

    // --- Logic ---
    function calcSteps() {
        steps = [];
        let k = 0;

        steps.push({ line: 0, type: 'info', msg: 'Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·: k â† 0', i: -1, k: 0 });

        for (let i = 0; i < 12; i++) {
            steps.push({ line: 1, type: 'loop', msg: `Î•Ï€Î±Î½Î¬Î»Î·ÏˆÎ· Î³Î¹Î± i = ${i+1}`, i: i, k: k });
            
            steps.push({ 
                line: 2, type: 'cmp', 
                msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: Î•Î¯Î½Î±Î¹ Ï„Î¿ ${NUMBERS[i]} > 0;`, 
                i: i, k: k 
            });

            if (NUMBERS[i] > 0) {
                k++;
                steps.push({ 
                    line: 3, type: 'calc', 
                    msg: `ÎÎ±Î¹. Î¤Î¿ k Î±Ï…Î¾Î¬Î½ÎµÏ„Î±Î¹ ÏƒÎµ ${k}`,
                    i: i, k: k 
                });

                steps.push({ 
                    line: 4, type: 'copy_anim', 
                    srcIdx: i, destIdx: k-1, val: NUMBERS[i], 
                    msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… ${NUMBERS[i]} ÏƒÏ„Î· Î¸Î­ÏƒÎ· Î’[${k}]`,
                    i: i, k: k
                });
            }
        }

        steps.push({ line: 7, type: 'info', msg: 'Î¤Î­Î»Î¿Ï‚ Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®Ï‚. Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·.', i: 11, k: k });
        for (let j = 0; j < k; j++) {
            steps.push({ 
                line: 8, type: 'print', val: data.A.filter(x=>x>0)[j], 
                msg: `Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿Ï… Î’[${j+1}]`,
                i: -1, k: j+1 
            });
        }
    }

    // --- Pointers Logic ---
    function updatePointers(i, k) {
        const ptrI = document.getElementById('ptr-i');
        const ptrK = document.getElementById('ptr-k');

        if (i >= 0) {
            ptrI.style.top = (i * STEP_HEIGHT) + 'px';
        } else {
            ptrI.style.top = HEADER_OFFSET + 'px';
        }

        if (k > 0) {
            ptrK.style.top = ((k - 1) * STEP_HEIGHT) + 'px';
        } else if (k === 0) {
            ptrK.style.top = HEADER_OFFSET + 'px';
        } else {
             ptrK.style.top = ((k - 1) * STEP_HEIGHT) + 'px';
        }
    }

    // --- Animation Logic ---
    function flyElement(srcIdx, destIdx, val, callback) {
        const srcEl = document.getElementById(`c-A-${srcIdx}`);
        const destWrap = document.getElementById(`wrap-B-${destIdx}`);
        
        // Scroll into view
        srcEl.scrollIntoView({behavior: "smooth", block: "center"});

        setTimeout(() => {
            const r1 = srcEl.getBoundingClientRect();
            const r2 = destWrap.getBoundingClientRect();

            const flyer = document.createElement('div');
            flyer.className = 'flying-cell';
            flyer.innerText = val;
            flyer.style.width = r1.width + 'px';
            flyer.style.height = r1.height + 'px';
            flyer.style.left = r1.left + 'px';
            flyer.style.top = r1.top + 'px';
            
            document.body.appendChild(flyer);

            flyer.getBoundingClientRect();

            const dur = speed * 0.8; 
            flyer.style.transition = `all ${dur}ms ease-in-out`;
            flyer.style.left = r2.left + 'px';
            flyer.style.top = r2.top + 'px';

            setTimeout(() => {
                flyer.remove();
                callback();
            }, dur + 50);
        }, 100);
    }

    // --- Execution ---
    function step() {
        if (isAnimating) return; 
        if (stepIdx >= steps.length - 1) {
            isPlaying = false;
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
            return;
        }

        stepIdx++;
        runStep(steps[stepIdx]);
    }

    function runStep(s) {
       // --- Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î‘Î»Î»Î±Î³Î® ÎµÏ„Î¹ÎºÎ­Ï„Î±Ï‚ Î´ÎµÎ¯ÎºÏ„Î· ÏƒÎµ 'i' ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· ---
    const labelEl = document.querySelector('#ptr-k .pointer-label');
    if (labelEl) {
        // Î‘Î½ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÏƒÏ„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï„Î¿Ï… 2Î¿Ï… Î²ÏÏŒÏ‡Î¿Ï… (index 7, 8, 9 Ï€Î¿Ï… Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡Î¿ÏÎ½ ÏƒÏ„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ 8,9,10)
        if (s.line >= 7) { 
            labelEl.innerText = 'i';
        } else {
            labelEl.innerText = 'k';
        }
    }
    // ------------------------------------------------------------------
        document.querySelectorAll('.code-line').forEach(e => e.classList.remove('active'));
        const lineEl = document.getElementById(`line-${s.line}`);
        if(lineEl) lineEl.classList.add('active');

        document.getElementById('narrativeBox').innerText = s.msg;
        document.querySelectorAll('.highlight-check').forEach(e => e.classList.remove('highlight-check'));

        updatePointers(s.i, s.k);

        if (s.type === 'cmp') {
            document.getElementById(`c-A-${s.i}`).classList.add('highlight-check');
            const el = document.getElementById(`wrap-A-${s.i}`);
            if (el) el.scrollIntoView({behavior: "smooth", block: "center"});
        }
        else if (s.type === 'copy_anim') {
            isAnimating = true;
            toggleControls(false);

            flyElement(s.srcIdx, s.destIdx, s.val, () => {
                updateCellB(s.destIdx, s.val);
                isAnimating = false;
                toggleControls(true);
                if (isPlaying) timer = setTimeout(step, speed * 0.2);
            });
            return; 
        }
        else if (s.type === 'print') {
            const log = document.getElementById('outputLog');
            log.innerHTML += `<div class="log-item">${s.val}</div>`;
            log.scrollTop = log.scrollHeight;
            const el = document.getElementById(`wrap-B-${s.k-1}`); 
            if(el) el.classList.add('highlight-check');
        }

        if (isPlaying) {
            timer = setTimeout(step, speed);
        }
    }

    function updateCellB(idx, val) {
        const el = document.getElementById(`c-B-${idx}`);
        el.querySelector('.cell-val').innerText = val;
        el.classList.remove('hidden-slot');
    }

    function toggleControls(enable) {
        document.getElementById('btnStep').disabled = !enable;
    }

    function play() {
        if (isAnimating) return;
        if (!isPlaying) {
            isPlaying = true;
            document.getElementById('btnPlay').innerText = "â¸ Î Î±ÏÏƒÎ·";
            step();
        } else {
            isPlaying = false;
            clearTimeout(timer);
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        }
    }

    function updateSpeed() {
        speed = 1550 - document.getElementById('speedSlider').value;
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    init();
function toggleCode() {
    const codePanel = document.querySelector('.col-code');
    codePanel.classList.toggle('hidden');
    
    // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ: Î‘Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï„Î¿Ï… ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Î±Î½ Î¸ÎµÏ‚
    const btn = document.getElementById('btnCode');
    if (codePanel.classList.contains('hidden')) {
        btn.innerText = "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±";
    } else {
        btn.innerText = "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }
}
</script>
</body>
</html>