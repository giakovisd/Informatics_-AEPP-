<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Î¼ÎµÏÎ¹ÎºÏÎ½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            --array-item-bg: #3b82f6;
            --array-item-text: #ffffff;
            --compare-color: #f59e0b;
            --swap-color: #ef4444;
            --border-color: #cbd5e1;
            --arrow-color: #dc2626;
            --disabled-btn: #94a3b8;
        }

        body.dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --panel-bg: #1e293b;
            --highlight-line: #475569;
            --array-item-bg: #2563eb;
            --border-color: #334155;
            --arrow-color: #f87171;
            --disabled-btn: #475569;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header & Controls --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px; /* Î›Î¯Î³Î¿ ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ Î³Î¹Î± Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ */
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; }
        .controls-area { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        button {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        button.primary { background-color: var(--array-item-bg); color: white; border: none; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); color: #ccc; cursor: not-allowed; transform: none; border-color: transparent; }

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-left: 10px; }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            height: calc(100% - 70px);
            box-sizing: border-box;
        }

        /* LEFT: Code Panel */
        .col-code {
            flex: 0 0 360px;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .tabs { display: flex; border-bottom: 1px solid var(--border-color); background: #f1f5f9; }
        .tab {
            flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 0.9rem;
            border-bottom: 3px solid transparent; color: #64748b;
        }
        .tab.active { background: var(--panel-bg); border-bottom-color: var(--array-item-bg); color: var(--text-color); font-weight: bold; }

        .code-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .code-line { padding: 2px 6px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); color: #000; font-weight: bold; }

        /* CENTER: Visualization */
        .col-viz {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
        }

        .narrative {
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(59, 130, 246, 0.08);
            border-left: 4px solid var(--array-item-bg);
            font-size: 0.95rem;
            font-style: italic;
            min-height: 24px;
            display: flex;
            align-items: center;
        }

        .arrays-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            /* Î‘Î¥ÎÎ—ÎœÎ•ÎÎŸ GAP Î“Î™Î‘ ÎÎ‘ ÎœÎ—Î Î Î•Î¦Î¤Î•Î™ Î¤ÎŸ Î’Î•Î›Î‘ÎšÎ™ Î£Î¤ÎŸÎ Î”Î™Î Î›Î‘ÎÎŸ Î Î™ÎÎ‘ÎšÎ‘ */
            gap: 160px; 
            overflow: hidden;
            align-items: flex-start;
            padding-top: 20px;
        }

        .array-col { display: flex; flex-direction: column; align-items: center; position: relative; }
        .array-header { font-weight: bold; margin-bottom: 10px; font-size: 1rem; color: var(--text-color); }

        .cell-wrapper {
            position: relative;
            height: 34px;
            width: 130px;
            margin-bottom: 4px;
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: var(--array-item-bg);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            box-sizing: border-box;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: transform 0.2s, background-color 0.2s;
        }

        .cell-idx { position: absolute; left: -25px; font-size: 0.75rem; color: var(--text-color); opacity: 0.6; top: 9px; }
        .cell-val { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }

        /* States */
        .comparing { background-color: var(--compare-color) !important; transform: scale(1.05); z-index: 10; }
        .swapping { background-color: var(--swap-color) !important; transform: scale(1.05); }
        .hidden-slot { opacity: 0.15; background: #94a3b8; border: 1px dashed #64748b; }

        /* POINTER ARROW */
        .pointer-container {
            position: absolute;
            /* Î¤Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Î­Î¾Ï‰ Î±Ï€ÏŒ Ï„Î¿ ÎºÎµÎ»Î¯ */
            right: -100px; 
            top: 0;
            height: 100%;
            width: 90px;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: slideIn 0.2s ease-out;
            pointer-events: none;
            z-index: 20;
        }

        .pointer-arrow-symbol {
            font-size: 1.8rem;
            color: var(--arrow-color);
            line-height: 1;
            font-weight: bold;
        }

        .pointer-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--arrow-color);
            font-family: monospace;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }

        /* RIGHT: Output */
        .col-output {
            flex: 0 0 220px;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .output-header { padding: 10px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); }
        .output-log { flex: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 3px 0; }
/* ÎšÎ»Î¬ÏƒÎ· Î³Î¹Î± Î½Î± ÎºÏÏÎ²ÎµÎ¹ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± */
.col-code.hidden {
    display: none;
}
    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½ B' Ï„Î¬Î¾Î·Ï‚</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="resetSim()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        <button onclick="stepBack()">âª Î Î¯ÏƒÏ‰</button>
        <button class="primary" onclick="togglePlay()" id="btnPlay">â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
        <button onclick="stepForward()">Î’Î®Î¼Î± â©</button>
        <button onclick="fastForwardSort()" id="btnFast" style="border: 2px solid var(--border-color);">â© Î¤Î­Î»Î¿Ï‚ Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·Ï‚</button>
        <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ ÎšÏÎ´Î¹ÎºÎ±Ï‚</button>

        <div class="slider-container">
            <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
            <input type="range" min="50" max="1000" value="500" id="speedSlider" oninput="updateSpeed()">
        </div>

        <button onclick="toggleTheme()" id="btnTheme">ğŸŒ™</button>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code">
        <div class="tabs">
            <div class="tab active" onclick="setSol(1)" id="t1">Î›ÏÏƒÎ· 1: Î Î±ÏÎ¬Î»Î»Î·Î»Î·</div>
            <div class="tab" onclick="setSol(2)" id="t2">Î›ÏÏƒÎ· 2: Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®</div>
        </div>
        <div class="code-content" id="codeContainer"></div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">ÎˆÏ„Î¿Î¹Î¼Î¿ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...</div>
        
        <div class="arrays-wrapper" id="arraysContainer">
            </div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- Data (12 Items) ---
    const NAMES = [
        "Î“ÎµÏ‰ÏÎ³Î¯Î¿Ï…", "Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚", "Î‘Î»ÎµÎ¾Î¯Î¿Ï…", "Î”Î·Î¼Î·Ï„ÏÎ¯Î¿Ï…", "Î’Î±ÏƒÎ¹Î»ÎµÎ¯Î¿Ï…",
        "Î™Ï‰Î¬Î½Î½Î¿Ï…", "ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï…", "ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï…", "ÎœÎ±Î½ÏÎ»Î·Ï‚", "Î§ÏÎ®ÏƒÏ„Î¿Ï…",
        "Î‘Î½Ï„Ï‰Î½Î¯Î¿Ï…", "Î£Ï‰Ï„Î·ÏÎ¯Î¿Ï…" 
    ];
    // Classes
    const CLASSES = ['Î‘', 'Î’', 'Î“', 'Î’', 'Î‘', 'Î“', 'Î’', 'Î’', 'Î‘', 'Î“', 'Î’', 'Î‘'];

    const CODE1 = [
        "Î‘Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿Ï‚ Ï„Î±Î¾",
        "Î“Î¹Î± i Î±Ï€ÏŒ 2 Î¼Î­Ï‡ÏÎ¹ 12",
        "  Î“Î¹Î± j Î±Ï€ÏŒ 12 Î¼Î­Ï‡ÏÎ¹ i Î¼Îµ_Î²Î®Î¼Î± -1",
        "    Î‘Î½ ÎŸÎ[j-1] > ÎŸÎ[j] Ï„ÏŒÏ„Îµ",
        "      temp1 â† ON[j-1]",
        "      ON[j-1] â† ON[j]",
        "      ON[j] â† temp1",
        "      temp2 â† T[j-1]",
        "      T[j-1] â† T[j]",
        "      T[j] â† temp2",
        "    Î¤Î­Î»Î¿Ï‚_Î±Î½",
        "  Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 12",
        "  Î‘Î½ T[i] = 'Î’' Ï„ÏŒÏ„Îµ",
        "    Î“ÏÎ¬ÏˆÎµ ON[i], ' ', T[i]",
        "  Î¤Î­Î»Î¿Ï‚_Î±Î½",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î¤ÎµÎ»Î¿Ï‚ Ï„Î±Î¾"
    ];

    const CODE2 = [
        "k â† 0",
        "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 12",
        "  Î‘Î½ T[i] = 'Î’' Ï„ÏŒÏ„Îµ",
        "    k â† k + 1",
        "    ONB[k] â† ON[i]",
        "  Î¤Î­Î»Î¿Ï‚_Î±Î½",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î“Î¹Î± i Î±Ï€ÏŒ 2 Î¼Î­Ï‡ÏÎ¹ k",
        "  Î“Î¹Î± j Î±Ï€ÏŒ k Î¼Î­Ï‡ÏÎ¹ i Î¼Îµ_Î²Î®Î¼Î± -1",
        "    Î‘Î½ ONB[j-1] > ONB[j] Ï„ÏŒÏ„Îµ",
        "      temp â† ONB[j-1]",
        "      ONB[j-1] â† ONB[j]",
        "      ONB[j] â† temp",
        "    Î¤Î­Î»Î¿Ï‚_Î±Î½",
        "  Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
        "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ k",
        "  Î“ÏÎ¬ÏˆÎµ ONB[i]",
        "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
    ];

    // --- State ---
    let sol = 1;
    let data = { ON: [], T: [], ONB: [] };
    let steps = [];
    let stepIdx = -1;
    let timer = null;
    let isPlaying = false;
    let speed = 500;

    // --- Init ---
    function init() {
        data.ON = [...NAMES];
        data.T = [...CLASSES];
        data.ONB = new Array(12).fill(null); 
        
        renderCode();
        renderBaseArrays();
        calcSteps();
        updateUI();
        checkFastButtonState();
    }

    function setSol(n) {
        sol = n;
        document.getElementById('t1').className = n===1 ? 'tab active' : 'tab';
        document.getElementById('t2').className = n===2 ? 'tab active' : 'tab';
        resetSim();
    }

    function resetSim() {
        stop();
        stepIdx = -1;
        document.getElementById('outputLog').innerHTML = '';
        document.getElementById('narrativeBox').innerText = "ÎˆÏ„Î¿Î¹Î¼Î¿...";
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.pointer-container').forEach(e => e.remove());
        init();
    }

    // --- Fast Forward Logic ---
    function checkFastButtonState() {
        const btn = document.getElementById('btnFast');
        if (sol === 1) {
            btn.disabled = false;
        } else {
            // Î£Ï„Î· Î›ÏÏƒÎ· 2, Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î¼Î­Ï‡ÏÎ¹ Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ„Î·Î½ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· (step line >= 7)
            if (stepIdx > -1 && steps[stepIdx].line >= 7) {
                btn.disabled = false;
            } else {
                btn.disabled = true; 
            }
        }
    }

    function fastForwardSort() {
        stop();
        // Î’ÏÎµÏ‚ Ï„Î¿ Î²Î®Î¼Î± ÏŒÏ€Î¿Ï… Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ Î· Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ±Î¹ Î±ÏÏ‡Î¯Î¶ÎµÎ¹ Î· ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·
        let targetLine = (sol === 1) ? 13 : 16; 
        
        // Î’ÏÎ¯ÏƒÎºÎ¿Ï…Î¼Îµ Ï„Î¿ index Ï„Î¿Ï… Ï€ÏÏÏ„Î¿Ï… Î²Î®Î¼Î±Ï„Î¿Ï‚ Ï€Î¿Ï… Î±Ï†Î¿ÏÎ¬ Ï„Î·Î½ ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· (Î¼ÎµÏ„Î¬ Ï„Î± loops)
        let foundIdx = steps.findIndex(s => s.line >= targetLine);
        
        if (foundIdx === -1) foundIdx = steps.length - 1;

        // Î•ÎºÏ„ÎµÎ»Î¿ÏÎ¼Îµ "ÏƒÎ¹Ï‰Ï€Î·Î»Î¬" Ï„Î± Î²Î®Î¼Î±Ï„Î± Î¼Î­Ï‡ÏÎ¹ ÎµÎºÎµÎ¯
        // Î“Î¹Î± ÏƒÎ¹Î³Î¿Ï…ÏÎ¹Î¬, ÎºÎ¬Î½Î¿Ï…Î¼Îµ reset ÎºÎ±Î¹ Ï„ÏÎ­Ï‡Î¿Ï…Î¼Îµ Ï„Î· Î»Î¿Î³Î¹ÎºÎ® Î±Ï€ÏŒ Ï„Î·Î½ Î±ÏÏ‡Î® Î¼Î­Ï‡ÏÎ¹ Ï„Î¿ foundIdx
        // ÏÏƒÏ„Îµ Î½Î± Î­Ï‡Î¿Ï…Î¼Îµ ÏƒÏ‰ÏƒÏ„Î¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
        
        // Reset Logic State
        data.ON = [...NAMES];
        data.T = [...CLASSES];
        data.ONB = new Array(12).fill(null);
        document.getElementById('outputLog').innerHTML = '';

        // Run Logic fast
        for(let i=0; i < foundIdx; i++) {
            applyLogicOnly(steps[i]);
        }
        
        stepIdx = foundIdx - 1; // Î¤Î¿ Î²Î¬Î¶Î¿Ï…Î¼Îµ Î­Î½Î± Ï€ÏÎ¹Î½ ÏÏƒÏ„Îµ Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ "Î’Î®Î¼Î±" Î½Î± ÎµÎ¯Î½Î±Î¹ Î· Î³ÏÎ±Î¼Î¼Î® 14/16
        
        refreshArraysVisually();
        
        // Î•Î½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ UI Î³Î¹Î± Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î± (Î“ÏÎ±Î¼Î¼Î® 14 Î® 16)
        // Î ÏÎ¿Ï‡Ï‰ÏÎ¬Î¼Îµ +1 Î³Î¹Î± Î½Î± Ï†Ï‰Ï„Î¯ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®
        stepForward();
    }

    // --- Rendering ---
    function renderCode() {
        const lines = sol === 1 ? CODE1 : CODE2;
        const html = lines.map((l, i) => 
            `<div class="code-line" id="line-${i}"><span style="color:#888; margin-right:8px; user-select:none;">${i+1}</span>${l.replace(/\s/g, '&nbsp;')}</div>`
        ).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function renderBaseArrays() {
        const con = document.getElementById('arraysContainer');
        let html = '';

        // ON Column
        html += `<div class="array-col"><div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ ÎŸÎ</div>`;
        data.ON.forEach((v, i) => html += createCell('ON', i, v));
        html += `</div>`;

        // T Column
        html += `<div class="array-col"><div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î¤</div>`;
        data.T.forEach((v, i) => {
            let style = v==='Î’' ? 'font-weight:bold; color:var(--highlight-line);' : '';
            html += createCell('T', i, v, style);
        });
        html += `</div>`;

        // ONB Column (Only Sol 2)
        if (sol === 2) {
            html += `<div class="array-col"><div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ ÎŸÎB</div>`;
            for(let i=0; i<12; i++) {
                html += createCell('ONB', i, '', '', true);
            }
            html += `</div>`;
        }

        con.innerHTML = html;
    }

    function createCell(arr, idx, val, extraStyle='', isEmpty=false) {
        const cls = isEmpty ? 'cell hidden-slot' : 'cell';
        return `
            <div class="cell-wrapper" id="wrap-${arr}-${idx}">
                <div id="c-${arr}-${idx}" class="${cls}" style="${extraStyle}">
                    <span class="cell-idx">${idx+1}</span>
                    <span class="cell-val">${val}</span>
                </div>
            </div>
        `;
    }

    // --- Logic & Step Calculation ---
    function calcSteps() {
        steps = [];
        let sON = [...NAMES];
        let sT = [...CLASSES];
        let sONB = [];
        let k = 0;

        if (sol === 1) {
            // --- Solution 1 ---
            for (let i = 1; i < 12; i++) {
                steps.push({ line: 1, type: 'loop', ptr: {arr:'ON', idx:i, label:'i'}, msg: `Î•Î¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·: i=${i+1}` });
                for (let j = 11; j >= i; j--) {
                    steps.push({ 
                        line: 2, type: 'loop', ptr: {arr:'ON', idx:j, label:'j'}, 
                        msg: `Î•ÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ® ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·: j=${j+1}` 
                    });
                    
                    steps.push({ 
                        line: 3, type: 'cmp', arr: 'ON', idx1: j-1, idx2: j, 
                        msg: `Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·: ${sON[j-1]} > ${sON[j]}`,
                        ptr: {arr:'ON', idx:j, label:'j'}
                    });

                    if (sON[j-1] > sON[j]) {
                        // Swap ON
                        [sON[j-1], sON[j]] = [sON[j], sON[j-1]];
                        steps.push({ line: 4, type: 'swap', arr: 'ON', idx1: j-1, idx2: j, msg: 'Î‘Î½Ï„Î¹Î¼ÎµÏ„Î¬Î¸ÎµÏƒÎ· ÎŸÎ½Î¿Î¼Î¬Ï„Ï‰Î½', ptr: {arr:'ON', idx:j, label:'j'} });
                        
                        // Swap T
                        [sT[j-1], sT[j]] = [sT[j], sT[j-1]];
                        steps.push({ line: 7, type: 'swap', arr: 'T', idx1: j-1, idx2: j, msg: 'Î‘Î½Ï„Î¹Î¼ÎµÏ„Î¬Î¸ÎµÏƒÎ· Î¤Î¬Î¾ÎµÏ‰Î½' });
                    }
                }
            }
            // Print (Starts at line 13 in array index, which is line 14 in code view)
            steps.push({ line: 13, type: 'info', msg: 'ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·Ï‚. ÎˆÎ½Î±ÏÎ¾Î· ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·Ï‚.' });
            for (let i = 0; i < 12; i++) {
                steps.push({ line: 14, type: 'chk', arr: 'T', idx: i, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ T[${i+1}] = 'Î’'`, ptr: {arr:'T', idx:i, label:'i'} });
                if (sT[i] === 'Î’') {
                    steps.push({ line: 15, type: 'print', val: `${sON[i]} (${sT[i]})`, ptr: {arr:'ON', idx:i, label:'i'} });
                }
            }
        } else {
            // --- Solution 2 ---
            steps.push({ line: 0, type: 'info', msg: 'k <- 0' });
            for(let i=0; i<12; i++) {
                steps.push({ line: 1, type: 'loop', ptr:{arr:'ON', idx:i, label:'i'}, msg: `Î”Î¹Î¬ÏƒÏ‡Î¹ÏƒÎ· Ï€Î¯Î½Î±ÎºÎ±: i=${i+1}` });
                if(sT[i] === 'Î’') {
                    k++;
                    sONB[k-1] = sON[i];
                    steps.push({ line: 3, type: 'calc', msg: `Î’ÏÎ­Î¸Î·ÎºÎµ Î¼Î±Î¸Î·Ï„Î®Ï‚. Î¤Î¿ k Î³Î¯Î½ÎµÏ„Î±Î¹ ${k}`, ptr: {arr:'ONB', idx:k-1, label:'k'} });
                    steps.push({ 
                        line: 4, type: 'copy', src: i, dest: k-1, val: sON[i], 
                        msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ${sON[i]} ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± ONB[${k}]`,
                        ptr: {arr:'ONB', idx:k-1, label:'k'}
                    });
                }
            }
            // Sort ONB (Start Line 7)
            for(let i=1; i<k; i++) {
                steps.push({ line: 7, type: 'loop', ptr: {arr:'ONB', idx:i, label:'i'}, msg: `Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ONB: i=${i+1}` });
                for(let j=k-1; j>=i; j--) {
                    steps.push({ 
                        line: 9, type: 'cmp', arr:'ONB', idx1: j-1, idx2: j, 
                        msg: `Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· ONB`, ptr: {arr:'ONB', idx:j, label:'j'}
                    });
                    if(sONB[j-1] > sONB[j]) {
                        [sONB[j-1], sONB[j]] = [sONB[j], sONB[j-1]];
                        steps.push({ 
                            line: 10, type: 'swap', arr: 'ONB', idx1: j-1, idx2: j, 
                            msg: 'Î‘Î½Ï„Î¹Î¼ÎµÏ„Î¬Î¸ÎµÏƒÎ· ÏƒÏ„Î¿ ONB', ptr: {arr:'ONB', idx:j, label:'j'}
                        });
                    }
                }
            }
            // Print ONB (Start Line 16)
            steps.push({ line: 16, type: 'info', msg: 'Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Ï„ÎµÎ»Î¹ÎºÎ¿Ï Ï€Î¯Î½Î±ÎºÎ±' });
            for(let i=0; i<k; i++) {
                steps.push({ line: 17, type: 'print', val: sONB[i], ptr: {arr:'ONB', idx:i, label:'i'} });
            }
        }
    }

    // --- Execution ---
    function stepForward() {
        if (stepIdx >= steps.length - 1) return;
        stepIdx++;
        runStep(steps[stepIdx]);
        checkFastButtonState(); // Check if button should enable (Sol 2)
    }

    function stepBack() {
        if (stepIdx <= 0) { resetSim(); return; }
        
        let target = stepIdx - 1;
        // Reset Logic
        data.ON = [...NAMES];
        data.T = [...CLASSES];
        data.ONB = new Array(12).fill(null);
        document.getElementById('outputLog').innerHTML = '';
        
        for(let i=0; i<=target; i++) {
            applyLogicOnly(steps[i]);
        }
        stepIdx = target;
        refreshArraysVisually();
        runStep(steps[stepIdx], true);
        checkFastButtonState();
    }

    function applyLogicOnly(s) {
        if(s.type === 'swap') {
            let dArr = s.arr==='ON'? data.ON : (s.arr==='T'? data.T : data.ONB);
            [dArr[s.idx1], dArr[s.idx2]] = [dArr[s.idx2], dArr[s.idx1]];
        } else if (s.type === 'copy') {
            data.ONB[s.dest] = s.val;
        } else if (s.type === 'print') {
            document.getElementById('outputLog').innerHTML += `<div class="log-item">${s.val}</div>`;
        }
    }

    function refreshArraysVisually() {
        for(let i=0; i<12; i++) {
            updateCell('ON', i, data.ON[i]);
            updateCell('T', i, data.T[i]);
            if(sol===2) updateCell('ONB', i, data.ONB[i]);
        }
    }

    function runStep(s, isBack=false) {
        // Highlight Code
        document.querySelectorAll('.code-line').forEach(e => e.classList.remove('active'));
        const lineEl = document.getElementById(`line-${s.line}`);
        if(lineEl) {
            lineEl.classList.add('active');
            lineEl.scrollIntoView({block: "nearest", behavior: "smooth"});
        }

        // Narrative
        if(s.msg) {
            document.getElementById('narrativeBox').innerText = s.msg;
        }

        // Cleanup Visuals
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('comparing', 'swapping'));
        document.querySelectorAll('.pointer-container').forEach(p => p.remove());

        // Show Pointer (Arrow + Var Name)
        if (s.ptr) {
            showPointer(s.ptr.arr, s.ptr.idx, s.ptr.label);
        }

        // Actions
        if (s.type === 'cmp') {
            high(s.arr, s.idx1, 'comparing');
            high(s.arr, s.idx2, 'comparing');
        } 
        else if (s.type === 'chk') {
            high(s.arr, s.idx, 'comparing');
        }
        else if (s.type === 'swap') {
            high(s.arr, s.idx1, 'swapping');
            high(s.arr, s.idx2, 'swapping');
            
            let dArr = s.arr==='ON'? data.ON : (s.arr==='T'? data.T : data.ONB);
            [dArr[s.idx1], dArr[s.idx2]] = [dArr[s.idx2], dArr[s.idx1]];
            updateCell(s.arr, s.idx1, dArr[s.idx1]);
            updateCell(s.arr, s.idx2, dArr[s.idx2]);
        }
        else if (s.type === 'copy') {
            data.ONB[s.dest] = s.val;
            updateCell('ONB', s.dest, s.val);
            high('ON', s.src, 'comparing');
            high('ONB', s.dest, 'swapping');
        }
        else if (s.type === 'print' && !isBack) {
            const log = document.getElementById('outputLog');
            log.innerHTML += `<div class="log-item">${s.val}</div>`;
            log.scrollTop = log.scrollHeight;
        }
    }

    function showPointer(arr, idx, label) {
        const wrapper = document.getElementById(`wrap-${arr}-${idx}`);
        if(wrapper) {
            const container = document.createElement('div');
            container.className = 'pointer-container';
            
            const arrow = document.createElement('span');
            arrow.className = 'pointer-arrow-symbol';
            arrow.innerHTML = 'â¬…'; 
            
            const text = document.createElement('span');
            text.className = 'pointer-label';
            text.innerText = label;

            container.appendChild(arrow);
            container.appendChild(text);
            wrapper.appendChild(container);
        }
    }

    function high(arr, idx, cls) {
        const el = document.getElementById(`c-${arr}-${idx}`);
        if(el) el.classList.add(cls);
    }

    function updateCell(arr, idx, val) {
        const el = document.getElementById(`c-${arr}-${idx}`);
        if(!el) return;
        el.querySelector('.cell-val').innerText = val || '';
        if(arr === 'ONB') {
            if(val) el.classList.remove('hidden-slot');
            else el.classList.add('hidden-slot');
        }
    }

    // --- Controls ---
    function togglePlay() { isPlaying ? stop() : start(); }
    function start() { isPlaying=true; document.getElementById('btnPlay').innerText = "â¸ Î Î±ÏÏƒÎ·"; loop(); }
    function stop() { isPlaying=false; clearTimeout(timer); document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·"; }
    function loop() { if(isPlaying && stepIdx < steps.length-1) { stepForward(); timer = setTimeout(loop, speed); } else { stop(); } }
    function updateSpeed() { speed = 1050 - document.getElementById('speedSlider').value; }
    function toggleTheme() { document.body.classList.toggle('dark-mode'); }

    // Start
    init();
function toggleCode() {
    const codePanel = document.querySelector('.col-code');
    codePanel.classList.toggle('hidden');
    
    // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ: Î‘Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï„Î¿Ï… ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Î±Î½ Î¸ÎµÏ‚
    const btn = document.getElementById('btnCode');
    if (codePanel.classList.contains('hidden')) {
        btn.innerText = "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±";
    } else {
        btn.innerText = "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }
}
</script>
</body>
</html>