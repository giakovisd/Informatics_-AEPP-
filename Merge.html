<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î£Ï…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ· Î Î¹Î½Î¬ÎºÏ‰Î½</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            --array-item-bg: #3b82f6;
            --array-item-text: #ffffff;
            --compare-color: #f59e0b;
            --flyer-bg: #8b5cf6; /* ÎœÏ‰Î² Î³Î¹Î± Ï„Î· ÏƒÏ…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ· */
            --border-color: #cbd5e1;
            --arrow-color: #dc2626;
            --disabled-btn: #94a3b8;
        }

        body.dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --panel-bg: #1e293b;
            --highlight-line: #475569;
            --array-item-bg: #2563eb;
            --border-color: #334155;
            --arrow-color: #f87171;
            --disabled-btn: #475569;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            box-sizing: border-box;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; }
        .controls-area { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        button {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        button.primary { background-color: var(--array-item-bg); color: white; border: none; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); color: #ccc; cursor: not-allowed; }

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-left: 10px; }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 15px;
            gap: 15px;
            height: calc(100% - 70px);
            box-sizing: border-box;
        }

        /* LEFT: Code Panel */
        .col-code {
            flex: 0 0 380px;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .tabs { 
            display: flex; 
            flex-direction: column; 
            background: #f1f5f9; 
            border-bottom: 1px solid var(--border-color);
        }
        .tab {
            text-align: left; padding: 10px 15px; font-size: 0.85rem; cursor: pointer;
            border-left: 4px solid transparent; color: #64748b; border-bottom: 1px solid #e2e8f0;
        }
        .tab:hover { background: #e2e8f0; }
        .tab.active { background: var(--panel-bg); border-left-color: var(--array-item-bg); color: var(--text-color); font-weight: bold; }

        .code-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .code-line { padding: 2px 6px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); color: #000; font-weight: bold; }

        /* CENTER: Visualization */
        .col-viz {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
            position: relative;
        }

        .narrative {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(139, 92, 246, 0.1); 
            border-left: 4px solid var(--flyer-bg);
            font-size: 0.95rem;
            font-style: italic;
            min-height: 24px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .arrays-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            /* Î‘Î¥ÎÎ—ÎœÎ•ÎÎ— Î‘Î ÎŸÎ£Î¤Î‘Î£Î— ÎœÎ•Î¤Î‘ÎÎ¥ Î Î™ÎÎ‘ÎšÎ©Î */
            gap: 120px; 
            overflow-x: auto; /* Scroll if too wide */
            overflow-y: auto; 
            align-items: flex-start;
            padding-top: 10px;
            padding-bottom: 40px;
            /* Extra padding left to accommodate left-side pointers */
            padding-left: 100px; 
        }

        .array-col { display: flex; flex-direction: column; align-items: center; position: relative; }
        
        .array-header { 
            font-weight: bold; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            font-size: 1rem; 
            color: var(--text-color); 
        }

        .cell-wrapper {
            position: relative;
            height: 36px;
            width: 100px;
            margin-bottom: 4px; 
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: var(--array-item-bg);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            box-sizing: border-box;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .cell-idx { position: absolute; left: -25px; font-size: 0.75rem; color: var(--text-color); opacity: 0.7; font-weight: bold; top: 10px; }
        .hidden-slot { opacity: 0.15; background: #94a3b8; border: 1px dashed #64748b; }
        .highlight-check { transform: scale(1.1); background-color: var(--compare-color) !important; z-index: 5; transition: transform 0.2s; }

        /* --- POINTERS --- */
        .pointer-track {
            position: absolute;
            /* ÎœÎ•Î¤Î‘ÎšÎ™ÎÎ—Î£Î— Î Î™ÎŸ Î‘Î¡Î™Î£Î¤Î•Î¡Î‘ Î“Î™Î‘ ÎÎ‘ ÎœÎ—Î ÎšÎ‘Î›Î¥Î Î¤Î•Î™ Î‘Î¡Î™Î˜ÎœÎŸÎ¥Î£ */
            left: -140px; 
            top: 40px; 
            width: 100px;
            height: 100%;
            pointer-events: none;
        }
        
        .sliding-pointer {
            position: absolute;
            top: 0;
            right: 0;
            height: 36px; 
            display: flex;
            align-items: center; 
            justify-content: flex-end;
            gap: 5px;
            transition: top 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 1;
        }

        .pointer-arrow-symbol { font-size: 1.5rem; color: var(--arrow-color); line-height: 0; font-weight: bold; padding-bottom: 2px; }
        .pointer-label { font-size: 1.1rem; font-weight: bold; color: var(--arrow-color); font-family: monospace; }

        /* --- FLYING ELEMENT --- */
        .flying-cell {
            position: fixed;
            z-index: 9999;
            background-color: var(--flyer-bg);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        /* RIGHT: Output */
        .col-output {
            flex: 0 0 200px;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .output-header { padding: 10px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); }
        .output-log { flex: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 3px 0; }

/* ÎšÎ»Î¬ÏƒÎ· Î³Î¹Î± Î½Î± ÎºÏÏÎ²ÎµÎ¹ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± */
.col-code.hidden {
    display: none;
}
    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>Î£Ï…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ·: Î‘[8], Î’[5] -> Î“[13])</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="resetSim()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        <button onclick="play()" id="btnPlay" class="primary">â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
        <button onclick="step()" id="btnStep">Î’Î®Î¼Î± â©</button>
        <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ ÎšÏÎ´Î¹ÎºÎ±Ï‚</button>
        
        <div class="slider-container">
            <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
            <input type="range" min="50" max="1500" value="800" id="speedSlider" oninput="updateSpeed()">
        </div>

        <button onclick="toggleTheme()" id="btnTheme">ğŸŒ™</button>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code">
        <div class="tabs">
            <div class="tab active" onclick="setSolution(1)" id="t1">1. ÎœÎµ Ï‡ÏÎ®ÏƒÎ· Î¼ÎµÏ„ÏÎ·Ï„Î® k (i: 9-13)</div>
            <div class="tab" onclick="setSolution(2)" id="t2">2. ÎœÎµ Î±Ï†Î±Î¯ÏÎµÏƒÎ· (i: 9-13, B[i-8])</div>
            <div class="tab" onclick="setSolution(3)" id="t3">3. ÎœÎµ Ï€ÏÏŒÏƒÎ¸ÎµÏƒÎ· (i: 1-5, Î“[i+8])</div>
            <div class="tab" onclick="setSolution(4)" id="t4">4. ÎœÎµ Î¼ÎµÏ„ÏÎ·Ï„Î® k (i: 1-5, kâ†k+1)</div>
        </div>
        <div class="code-content" id="codeContainer"></div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î»ÏÏƒÎ· ÎºÎ±Î¹ Ï€Î±Ï„Î®ÏƒÏ„Îµ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...</div>
        
        <div class="arrays-wrapper" id="arraysContainer">
            </div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- Data ---
    const A_DATA = [10, 20, 30, 40, 50, 60, 70, 80];
    const B_DATA = [5, 15, 25, 35, 45];
    
    // --- Code Variants ---
    const SOL_CODES = {
        1: [
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 8", "  Î“[i] â† Î‘[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Îº â† 0",
            "Î“Î¹Î± i Î±Ï€ÏŒ 9 Î¼Î­Ï‡ÏÎ¹ 13", "  Îº â† Îº + 1", "  Î“[i] â† Î’[Îº]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 13", "  Î“ÏÎ¬ÏˆÎµ Î“[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ],
        2: [
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 8", "  Î“[i] â† Î‘[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 9 Î¼Î­Ï‡ÏÎ¹ 13", "  Î“[i] â† Î’[i - 8]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 13", "  Î“ÏÎ¬ÏˆÎµ Î“[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ],
        3: [
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 8", "  Î“[i] â† Î‘[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 5", "  Î“[i + 8] â† Î’[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 13", "  Î“ÏÎ¬ÏˆÎµ Î“[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ],
        4: [
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 8", "  Î“[i] â† Î‘[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Îº â† 8", 
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 5", "  Îº â† Îº + 1", "  Î“[Îº] â† Î’[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚",
            "Î“Î¹Î± i Î±Ï€ÏŒ 1 Î¼Î­Ï‡ÏÎ¹ 13", "  Î“ÏÎ¬ÏˆÎµ Î“[i]", "Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚"
        ]
    };

    // --- State ---
    let currentSol = 1;
    let data = { A: [], B: [], C: [] };
    let steps = [];
    let stepIdx = -1;
    let timer = null;
    let isPlaying = false;
    let isAnimating = false;
    let speed = 800;

    const STEP_HEIGHT = 40; // Cell 36 + Margin 4
    const HEADER_OFFSET = -40; 

    // --- Init ---
    function init() {
        data.A = [...A_DATA];
        data.B = [...B_DATA];
        data.C = new Array(13).fill(null); 
        
        renderCode();
        renderBaseArrays();
        calcSteps();
        
        updatePointers({}, true); // Reset pointers
    }

    function setSolution(n) {
        currentSol = n;
        document.querySelectorAll('.tab').forEach((t, i) => {
            t.classList.toggle('active', i+1 === n);
        });
        resetSim();
    }

    function resetSim() {
        isPlaying = false;
        isAnimating = false;
        clearTimeout(timer);
        stepIdx = -1;
        document.getElementById('outputLog').innerHTML = '';
        document.getElementById('narrativeBox').innerText = "ÎˆÏ„Î¿Î¹Î¼Î¿ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...";
        document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.flying-cell').forEach(e => e.remove());
        
        init();
    }

    // --- Rendering ---
    function renderCode() {
        const lines = SOL_CODES[currentSol];
        const html = lines.map((l, i) => 
            `<div class="code-line" id="line-${i}">
                <span style="color:#888; margin-right:8px; user-select:none;">${i+1}</span>
                ${l.replace(/ /g, '&nbsp;')}
             </div>`
        ).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function renderBaseArrays() {
        const con = document.getElementById('arraysContainer');
        let html = '';

        // Array A
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î‘</div>
                    <div class="pointer-track" id="track-A"></div>`;
        data.A.forEach((v, i) => html += createCell('A', i, v));
        html += `</div>`;

        // Array B
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î’</div>
                    <div class="pointer-track" id="track-B"></div>`;
        data.B.forEach((v, i) => html += createCell('B', i, v));
        html += `</div>`;

        // Array C (Target)
        html += `<div class="array-col">
                    <div class="array-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î“</div>
                    <div class="pointer-track" id="track-C"></div>`;
        for(let i=0; i<13; i++) html += createCell('C', i, '', '', true);
        html += `</div>`;

        con.innerHTML = html;
    }

    function createCell(arr, idx, val, extraStyle='', isEmpty=false) {
        const cls = isEmpty ? 'cell hidden-slot' : 'cell';
        return `
            <div class="cell-wrapper" id="wrap-${arr}-${idx}">
                <div id="c-${arr}-${idx}" class="${cls}" style="${extraStyle}">
                    <span class="cell-idx">${idx+1}</span>
                    <span class="cell-val">${val}</span>
                </div>
            </div>
        `;
    }

    function createPointerHTML(label) {
        return `<div id="ptr-${label}" class="sliding-pointer" style="display:none; top: ${HEADER_OFFSET}px;">
                    <span class="pointer-label">${label}</span>
                    <span class="pointer-arrow-symbol">â¡</span>
                </div>`;
    }

    // --- Logic Generation ---
    function calcSteps() {
        steps = [];
        // Phase 1: Copy A to C (Common to all)
        for(let i=0; i<8; i++) {
            steps.push({ 
                line: 0, type: 'loop', msg: `Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Î‘: i=${i+1}`, 
                ptrs: { i: {arr:'A', idx:i} } 
            });
            steps.push({ 
                line: 1, type: 'copy_anim', 
                srcArr:'A', srcIdx:i, destArr:'C', destIdx:i, val: A_DATA[i],
                msg: `Î“[${i+1}] â† Î‘[${i+1}]`,
                ptrs: { i: {arr:'A', idx:i} } 
            });
        }

        // Phase 2: Copy B to C (Depends on Solution)
        if (currentSol === 1) { // k counter, i: 9-13
            let k = 0;
            steps.push({ line: 3, type: 'info', msg: 'k â† 0', ptrs: { k: {arr:'B', idx:-1} } });
            for(let i=8; i<13; i++) {
                steps.push({ line: 4, type: 'loop', msg: `i=${i+1}`, ptrs: { i: {arr:'C', idx:i}, k: {arr:'B', idx:k-1} } });
                k++;
                steps.push({ line: 5, type: 'calc', msg: `k Î³Î¯Î½ÎµÏ„Î±Î¹ ${k}`, ptrs: { i: {arr:'C', idx:i}, k: {arr:'B', idx:k-1} } });
                steps.push({ 
                    line: 6, type: 'copy_anim', 
                    srcArr:'B', srcIdx:k-1, destArr:'C', destIdx:i, val: B_DATA[k-1],
                    msg: `Î“[${i+1}] â† Î’[${k}]`,
                    ptrs: { i: {arr:'C', idx:i}, k: {arr:'B', idx:k-1} }
                });
            }
            // Print Loop
            for(let i=0; i<13; i++) steps.push({ line: 9, type: 'print', val: (i<8?A_DATA[i]:B_DATA[i-8]), ptrs: { i: {arr:'C', idx:i} } });

        } else if (currentSol === 2) { // B[i-8]
            for(let i=8; i<13; i++) {
                steps.push({ line: 3, type: 'loop', msg: `i=${i+1}`, ptrs: { i: {arr:'C', idx:i} } });
                let bIdx = i - 8;
                steps.push({ 
                    line: 4, type: 'copy_anim', 
                    srcArr:'B', srcIdx:bIdx, destArr:'C', destIdx:i, val: B_DATA[bIdx],
                    msg: `Î“[${i+1}] â† Î’[${i+1}-8] (Î´Î·Î». Î’[${bIdx+1}])`,
                    ptrs: { i: {arr:'C', idx:i} }
                });
            }
            for(let i=0; i<13; i++) steps.push({ line: 6, type: 'print', val: (i<8?A_DATA[i]:B_DATA[i-8]), ptrs: { i: {arr:'C', idx:i} } });

        } else if (currentSol === 3) { // i: 1-5, C[i+8]
            for(let i=0; i<5; i++) {
                steps.push({ line: 3, type: 'loop', msg: `i=${i+1}`, ptrs: { i: {arr:'B', idx:i} } });
                let cIdx = i + 8;
                steps.push({ 
                    line: 4, type: 'copy_anim', 
                    srcArr:'B', srcIdx:i, destArr:'C', destIdx:cIdx, val: B_DATA[i],
                    msg: `Î“[${i+1}+8] â† Î’[${i+1}] (Î“[${cIdx+1}])`,
                    ptrs: { i: {arr:'B', idx:i} }
                });
            }
            for(let i=0; i<13; i++) steps.push({ line: 6, type: 'print', val: (i<8?A_DATA[i]:B_DATA[i-8]), ptrs: { i: {arr:'C', idx:i} } });

        } else if (currentSol === 4) { // k counter for C
            let k = 8;
            steps.push({ line: 3, type: 'info', msg: 'k â† 8 (Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î¸Î­ÏƒÎ· Î‘)', ptrs: { k: {arr:'C', idx:7} } });
            for(let i=0; i<5; i++) {
                steps.push({ line: 4, type: 'loop', msg: `i=${i+1}`, ptrs: { i: {arr:'B', idx:i}, k: {arr:'C', idx:k-1} } });
                k++;
                steps.push({ line: 5, type: 'calc', msg: `k Î³Î¯Î½ÎµÏ„Î±Î¹ ${k}`, ptrs: { i: {arr:'B', idx:i}, k: {arr:'C', idx:k-1} } });
                steps.push({ 
                    line: 6, type: 'copy_anim', 
                    srcArr:'B', srcIdx:i, destArr:'C', destIdx:k-1, val: B_DATA[i],
                    msg: `Î“[${k}] â† Î’[${i+1}]`,
                    ptrs: { i: {arr:'B', idx:i}, k: {arr:'C', idx:k-1} }
                });
            }
            for(let i=0; i<13; i++) steps.push({ line: 9, type: 'print', val: (i<8?A_DATA[i]:B_DATA[i-8]), ptrs: { i: {arr:'C', idx:i} } });
        }
    }

    // --- Pointers Logic ---
    function updatePointers(ptrsObj, reset=false) {
        const tracks = { A: document.getElementById('track-A'), B: document.getElementById('track-B'), C: document.getElementById('track-C') };
        
        if(reset) {
            ['A','B','C'].forEach(t => tracks[t].innerHTML = '');
            return;
        }

        for (const [pName, pData] of Object.entries(ptrsObj)) {
            let el = document.getElementById(`ptr-${pName}`);
            
            if (!el) {
                let div = document.createElement('div');
                div.innerHTML = createPointerHTML(pName);
                el = div.firstChild;
            }

            const targetTrack = tracks[pData.arr];
            if (el.parentElement !== targetTrack) {
                targetTrack.appendChild(el);
            }

            el.style.display = 'flex';
            
            let topPos;
            if (pData.idx < 0) topPos = HEADER_OFFSET; 
            else topPos = pData.idx * STEP_HEIGHT;

            requestAnimationFrame(() => {
                el.style.top = topPos + 'px';
            });
        }
    }

    // --- Animation ---
    function flyElement(srcArr, srcIdx, destArr, destIdx, val, callback) {
        const srcEl = document.getElementById(`c-${srcArr}-${srcIdx}`);
        const destWrap = document.getElementById(`wrap-${destArr}-${destIdx}`);
        
        destWrap.scrollIntoView({behavior: "smooth", block: "nearest"});

        const r1 = srcEl.getBoundingClientRect();
        const r2 = destWrap.getBoundingClientRect();

        const flyer = document.createElement('div');
        flyer.className = 'flying-cell';
        flyer.innerText = val;
        flyer.style.width = r1.width + 'px';
        flyer.style.height = r1.height + 'px';
        flyer.style.left = r1.left + 'px';
        flyer.style.top = r1.top + 'px';
        
        document.body.appendChild(flyer);
        flyer.getBoundingClientRect(); 

        const dur = speed * 0.7;
        flyer.style.transition = `all ${dur}ms ease-in-out`;
        flyer.style.left = r2.left + 'px';
        flyer.style.top = r2.top + 'px';

        setTimeout(() => {
            flyer.remove();
            callback();
        }, dur + 50);
    }

    // --- Execution ---
    function step() {
        if (isAnimating) return;
        if (stepIdx >= steps.length - 1) {
            isPlaying = false;
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
            return;
        }
        stepIdx++;
        runStep(steps[stepIdx]);
    }

    function runStep(s) {
        document.querySelectorAll('.code-line').forEach(e => e.classList.remove('active'));
        if (s.line !== undefined) {
             const lineEl = document.getElementById(`line-${s.line}`);
             if(lineEl) lineEl.classList.add('active');
        }

        if(s.msg) document.getElementById('narrativeBox').innerText = s.msg;

        if (s.ptrs) updatePointers(s.ptrs);

        if (s.type === 'copy_anim') {
            isAnimating = true;
            toggleControls(false);
            
            document.getElementById(`c-${s.srcArr}-${s.srcIdx}`).classList.add('highlight-check');

            flyElement(s.srcArr, s.srcIdx, s.destArr, s.destIdx, s.val, () => {
                updateCellC(s.destIdx, s.val);
                document.getElementById(`c-${s.srcArr}-${s.srcIdx}`).classList.remove('highlight-check');
                isAnimating = false;
                toggleControls(true);
                if (isPlaying) timer = setTimeout(step, speed * 0.2);
            });
            return;
        } 
        else if (s.type === 'print') {
            const log = document.getElementById('outputLog');
            log.innerHTML += `<div class="log-item">${s.val}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        if (isPlaying) {
            timer = setTimeout(step, speed);
        }
    }

    function updateCellC(idx, val) {
        const el = document.getElementById(`c-C-${idx}`);
        el.querySelector('.cell-val').innerText = val;
        el.classList.remove('hidden-slot');
    }

    function toggleControls(enable) {
        document.getElementById('btnStep').disabled = !enable;
    }

    function play() {
        if (isAnimating) return;
        if (!isPlaying) {
            isPlaying = true;
            document.getElementById('btnPlay').innerText = "â¸ Î Î±ÏÏƒÎ·";
            step();
        } else {
            isPlaying = false;
            clearTimeout(timer);
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        }
    }

    function updateSpeed() {
        speed = 1550 - document.getElementById('speedSlider').value;
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    init();
function toggleCode() {
    const codePanel = document.querySelector('.col-code');
    codePanel.classList.toggle('hidden');
    
    // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ: Î‘Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï„Î¿Ï… ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Î±Î½ Î¸ÎµÏ‚
    const btn = document.getElementById('btnCode');
    if (codePanel.classList.contains('hidden')) {
        btn.innerText = "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±";
    } else {
        btn.innerText = "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }
}
</script>
</body>
</html>