<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¤ÎµÏ„ÏÎ±Î³Ï‰Î½Î¹ÎºÏŒÏ‚ Î Î¯Î½Î±ÎºÎ±Ï‚ (Responsive)</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --panel-bg: #ffffff;
            --highlight-line: #fde047;
            
            --col-main: #3b82f6; 
            --col-sec: #8b5cf6;  
            --col-success: #10b981; 
            
            --scan-color: #fef08a; 
            
            --border-color: #cbd5e1;
            --disabled-btn: #94a3b8;

            /* Code Syntax */
            --code-kw: #0000CD; 
            --code-sym: #FF0000; 
            --code-var: #000000; 
            --code-num: #008000;
            --code-str: #A020F0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ÎšÏÏÎ²ÎµÎ¹ Ï„Î¿ scroll ÏƒÏ„Î¿ body */
        }

        /* --- Header Responsive --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 60px;
            height: auto;
            flex-wrap: wrap;
            gap: 10px;
            z-index: 100;
            flex-shrink: 0;
        }

        .header-title h1 { margin: 0; font-size: 1.1rem; white-space: nowrap; }
        
        .controls-area { 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        /* Sim Controls (ÎºÏÏ…Î¼Î¼Î­Î½Î± Î±ÏÏ‡Î¹ÎºÎ¬) */
        #simControls {
            display: none; 
            gap: 8px; 
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: all 0.2s;
            white-space: nowrap;
            touch-action: manipulation;
        }
        button.primary { background-color: var(--col-main); color: white; border: none; }
        button:hover:not(:disabled) { filter: brightness(0.95); transform: translateY(-1px); }
        button:disabled { background-color: var(--disabled-btn); color: #fff; cursor: not-allowed; }

        .slider-container { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        input[type="range"] { width: 100px; }

        /* --- Main Layout Responsive --- */
        .main-container {
            display: flex;
            flex: 1;
            padding: 10px;
            gap: 10px;
            height: calc(100% - 70px);
            overflow: hidden;
        }

        /* Common Panel Styles */
        .col-code, .col-viz, .col-output {
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        /* --- DESKTOP LAYOUT (Default) --- */
        @media (min-width: 900px) {
            .col-code { flex: 0 0 450px; }
            .col-output { flex: 0 0 200px; }
            .col-viz { flex: 1; }
        }

        /* --- MOBILE/TABLET LAYOUT --- */
        @media (max-width: 899px) {
            .main-container {
                flex-direction: column;
                overflow-y: auto; /* Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ scroll ÏƒÎµ ÏŒÎ»Î· Ï„Î· ÏƒÎµÎ»Î¯Î´Î± */
                padding-bottom: 20px;
            }

            .col-code, .col-viz, .col-output {
                flex: none; /* ÎŒÏ‡Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ ÏÏˆÎ¿Ï‚ */
                width: 100%;
            }

            .col-viz {
                min-height: 420px; /* Î§ÏÏÎ¿Ï‚ Î³Î¹Î± Ï„Î¿ Ï€Î»Î­Î³Î¼Î± 5x5 */
                order: 1; /* Î ÏÏÏ„Î± Ï„Î¿ Ï€Î»Î­Î³Î¼Î± */
            }

            .col-output {
                height: 150px;
                order: 2; /* ÎœÎµÏ„Î¬ Î· Î­Î¾Î¿Î´Î¿Ï‚ */
            }

            .col-code {
                height: auto;
                min-height: 300px;
                order: 3; /* Î¤Î­Î»Î¿Ï‚ Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬/ÎºÏÎ´Î¹ÎºÎ±Ï‚ */
            }
            
            /* ÎšÏÏÎ²Î¿Ï…Î¼Îµ Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï‡ÏÏÎ¿Ï‚, Î® Ï„Î¿Î½ Î¼Î¹ÎºÏÎ±Î¯Î½Î¿Ï…Î¼Îµ */
            .header-title h1 { font-size: 1rem; }
        }

        /* --- Code Panel Internals --- */
        .tabs { 
            display: flex; 
            flex-direction: column;
            background: #f1f5f9; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 5px;
        }
        .tab {
            text-align: left; 
            padding: 8px 12px; 
            font-size: 0.85rem; 
            cursor: pointer;
            border-left: 4px solid transparent;
            border-bottom: 1px solid #e2e8f0;
            color: #64748b; 
            font-weight: bold;
            line-height: 1.2;
        }
        .tab:hover { background: #e2e8f0; }
        .tab.active { 
            background: var(--panel-bg); 
            border-left-color: var(--col-main); 
            color: var(--text-color); 
        }

        .problem-info {
            padding: 10px 15px;
            background-color: #fffbeb;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .info-header { font-weight: bold; color: #b45309; display: block; margin-bottom: 3px;}

        .algo-toggle {
            display: none; 
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            background: #f8fafc;
            gap: 10px;
        }
        .toggle-btn {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
            text-align: center;
            border: 1px solid #cbd5e1;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            color: #64748b;
        }
        .toggle-btn.active-algo {
            background: var(--col-main);
            color: white;
            border-color: var(--col-main);
            font-weight: bold;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        /* Overview Grid Buttons */
        .overview-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 ÏƒÏ„Î®Î»ÎµÏ‚ */
            gap: 10px;
        }
        /* Î£Îµ Ï€Î¿Î»Ï Î¼Î¹ÎºÏÎ¬ ÎºÎ¹Î½Î·Ï„Î¬, Î¼Î¯Î± ÏƒÏ„Î®Î»Î· */
        @media (max-width: 400px) {
            .overview-buttons { grid-template-columns: 1fr; }
        }
        
        .ov-btn {
            padding: 10px;
            text-align: left;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-color);
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 60px;
        }
        .ov-btn:hover { border-color: var(--col-main); background: #f0f9ff; }
        .ov-btn.active-btn { 
            background-color: var(--col-success); 
            color: white; 
            border-color: #059669; 
        }
        .ov-formula { 
            display: block; 
            font-family: monospace; 
            opacity: 0.8; 
            font-size: 1.1em; 
            margin-top: 4px;
        }

        .code-content {
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre; 
        }
        .code-line { padding: 2px 4px; border-radius: 3px; }
        .code-line.active { background-color: var(--highlight-line); font-weight: bold; }

        /* --- VISUALIZATION AREA --- */
        .narrative {
            padding: 8px;
            margin-bottom: 10px;
            background: rgba(59, 130, 246, 0.1); 
            border-left: 4px solid var(--col-main);
            font-size: 0.9rem;
            font-style: italic;
            min-height: 30px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .formula-box {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fff;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--col-main);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 50;
        }

        .scene-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center; 
            position: relative;
            /* Scroll Logic Î³Î¹Î± ÎºÎ¹Î½Î·Ï„Î¬ */
            overflow: auto;
            padding-top: 40px;
            padding-bottom: 20px;
        }

        /* GRID Styling */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 60px); /* Î›Î¯Î³Î¿ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ± ÎºÎµÎ»Î¹Î¬ Î³Î¹Î± ÎºÎ¹Î½Î·Ï„Î¬ */
            grid-template-rows: repeat(5, 60px);
            gap: 4px;
            position: relative;
            z-index: 1;
            margin: auto; /* ÎšÎµÎ½Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± */
        }

        .cell {
            width: 60px;
            height: 60px;
            background-color: #fff;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: #94a3b8; 
            transition: all 0.2s ease;
            position: relative;
            z-index: 5;
        }

        .cell-coords { font-size: 0.7rem; opacity: 0.6; }

        /* Animation States */
        .cell.scanning {
            background-color: var(--scan-color);
            transform: scale(1.05);
            z-index: 10;
            color: #000;
            border-color: #d97706;
        }

        .cell.selected {
            background-color: var(--col-success);
            color: white;
            border-color: #047857;
            transform: scale(1);
        }
        
        .cell.selected-sim {
            background-color: var(--col-main);
            color: white;
            border-color: #1e40af;
        }

        /* SVG Overlay for Lines */
        #svgOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20; 
            pointer-events: none; 
            overflow: visible; 
        }
        
        .diag-line {
            stroke: #dc2626; 
            stroke-width: 4;
            stroke-linecap: round;
            fill: none;
            marker-end: url(#arrowhead);
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 1s forwards ease-out;
        }
        
        @keyframes dash {
            to { stroke-dashoffset: 0; }
        }

        /* OUTPUT LOG */
        .output-header { padding: 8px; background: #f1f5f9; font-weight: bold; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; }
        .output-log { flex: 1; padding: 8px; overflow-y: auto; font-family: monospace; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid #eee; padding: 2px 0; }

        .kw { color: var(--code-kw); font-weight: bold; } 
        .sym { color: var(--code-sym); font-weight: bold; }
        .var { color: var(--code-var); }
        .num { color: var(--code-num); font-weight: bold; }
        .str { color: var(--code-str); }

        .col-code.hidden { display: none; }
    </style>
</head>
<body>

<svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#dc2626" />
    </marker>
  </defs>
</svg>

<header>
    <div class="header-title">
        <h1>Î™Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î Î¯Î½Î±ÎºÎ±</h1>
    </div>
    
    <div class="controls-area">
        <button onclick="init()">ğŸ”„ Î‘ÏÏ‡Î®</button>
        <div id="simControls" style="display:none; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
            <button onclick="play()" id="btnPlay" class="primary">â–¶ï¸ Î•ÎºÏ„Î­Î»ÎµÏƒÎ·</button>
            <button onclick="step()" id="btnStep">Î’Î®Î¼Î± â©</button>
            <button onclick="toggleCode()" id="btnCode">ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ·</button>
            <div class="slider-container">
                <span>Î¤Î±Ï‡ÏÏ„Î·Ï„Î±:</span>
                <input type="range" min="50" max="2000" value="800" id="speedSlider" oninput="updateSpeed()">
            </div>
        </div>
    </div>
</header>

<div class="main-container">
    
    <div class="col-code">
        <div class="tabs">
            <div class="tab active" onclick="setMode(0)">0. Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· & Î¤ÏÏ€Î¿Î¹</div>
            <div class="tab" onclick="setMode(1)">1. ÎšÏÏÎ¹Î± Î”Î¹Î±Î³ÏÎ½Î¹Î¿Ï‚</div>
            <div class="tab" onclick="setMode(2)">2. Î”ÎµÏ…Ï„ÎµÏÎµÏÎ¿Ï…ÏƒÎ± Î”Î¹Î±Î³.</div>
            <div class="tab" onclick="setMode(3)">3. ÎšÎ¬Ï„Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿</div>
            <div class="tab" onclick="setMode(4)">4. Î†Î½Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿</div>
            <div class="tab" onclick="setMode(5)">5. Î Î¬Î½Ï‰ Î±Ï€ÏŒ 2Î· Î”Î¹Î±Î³.</div>
            <div class="tab" onclick="setMode(6)">6. ÎšÎ¬Ï„Ï‰ Î±Ï€ÏŒ 2Î· Î”Î¹Î±Î³.</div>
        </div>
        
        <div class="problem-info" id="problemInfo">
            <span class="info-header">Î Î¯Î½Î±ÎºÎ±Ï‚ Î [5,5]</span>
            <span id="descText">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î± ÎºÎµÎ»Î¹Î¬.</span>
        </div>

        <div id="algoToggle" class="algo-toggle">
            <div id="btnOpt" class="toggle-btn active-algo" onclick="setAlgo('opt')">Î’Î­Î»Ï„Î¹ÏƒÏ„Î¿Ï‚</div>
            <div id="btnBrute" class="toggle-btn" onclick="setAlgo('brute')">ÎœÎµ ÎˆÎ»ÎµÎ³Ï‡Î¿ (Î‘Î)</div>
        </div>

        <div class="panel-content">
            <div id="overviewPanel" class="overview-buttons">
                <button class="ov-btn" onclick="showOverview(1)">ÎšÏÏÎ¹Î± Î”Î¹Î±Î³ÏÎ½Î¹Î¿Ï‚ <span class="ov-formula">i = j</span></button>
                <button class="ov-btn" onclick="showOverview(2)">Î”ÎµÏ…Ï„ÎµÏÎµÏÎ¿Ï…ÏƒÎ± Î”Î¹Î±Î³. <span class="ov-formula">i+j = N+1</span></button>
                <button class="ov-btn" onclick="showOverview(3)">ÎšÎ¬Ï„Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿ <span class="ov-formula">i > j</span></button>
                <button class="ov-btn" onclick="showOverview(4)">Î†Î½Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿ <span class="ov-formula">i < j</span></button>
                <button class="ov-btn" onclick="showOverview(5)">Î Î¬Î½Ï‰ Î±Ï€ÏŒ 2Î· Î”Î¹Î±Î³. <span class="ov-formula">i+j < N+1</span></button>
                <button class="ov-btn" onclick="showOverview(6)">ÎšÎ¬Ï„Ï‰ Î±Ï€ÏŒ 2Î· Î”Î¹Î±Î³. <span class="ov-formula">i+j > N+1</span></button>
            </div>

            <div id="codeContainer" class="code-content" style="display:none;"></div>
        </div>
    </div>

    <div class="col-viz">
        <div class="narrative" id="narrativeBox">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±...</div>
        
        <div class="formula-box" id="formulaBox">-</div>

        <div class="scene-wrapper">
            <div class="grid-container" id="gridContainer">
                <svg id="svgOverlay">
                    <line id="diagLine" class="diag-line" x1="0" y1="0" x2="0" y2="0" style="display:none;" />
                </svg>
            </div>
        </div>
    </div>

    <div class="col-output">
        <div class="output-header">ğŸ“º ÎŸÎ¸ÏŒÎ½Î· Î•Î¾ÏŒÎ´Î¿Ï…</div>
        <div class="output-log" id="outputLog"></div>
    </div>

</div>

<script>
    // --- State ---
    let currentMode = 0; // 0 = Overview
    let algoType = 'opt'; // 'opt' = Optimized, 'brute' = Check All with IF
    const N = 5;
    let steps = [];
    let stepIdx = -1;
    let timer = null;
    let isPlaying = false;
    let speed = 800;

    // --- Helpers ---
    function kw(t) { return `<span class="kw">${t}</span>`; }
    function sym(t) { return `<span class="sym">${t}</span>`; }
    function v(t) { return `<span class="var">${t}</span>`; }
    function n(t) { return `<span class="num">${t}</span>`; }
    function str(t) { return `<span class="str">${t}</span>`; }
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    // --- Codes ---
    function getCodes() {
        if (algoType === 'opt') {
            return {
                1: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("i")}${sym("]")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                2: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${v("j")} ${sym("<-")} ${n("6")} ${sym("-")} ${v("i")}`,
                    `  ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                3: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("2")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${v("i")}${sym("-")}${n("1")}`,
                    `    ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                4: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("4")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${v("i")}${sym("+")}${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `    ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ]
            };
        } else {
            return {
                1: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `    ${kw("Î‘Î½")} ${v("i")}${sym("=")}${v("j")} ${kw("Ï„ÏŒÏ„Îµ")}`,
                    `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                2: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `    ${kw("Î‘Î½")} ${v("i")}${sym("+")}${v("j")}${sym("=")}${n("5")}${sym("+")}${n("1")} ${kw("Ï„ÏŒÏ„Îµ")}`,
                    `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                3: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `    ${kw("Î‘Î½")} ${v("i")}${sym(">")}${v("j")} ${kw("Ï„ÏŒÏ„Îµ")}`,
                    `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ],
                4: [
                    `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                    `    ${kw("Î‘Î½")} ${v("i")}${sym("<")}${v("j")} ${kw("Ï„ÏŒÏ„Îµ")}`,
                    `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                    `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                    `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                    `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
                ]
            };
        }
    }
    
    function getCodes56() {
        return {
            5: [
                `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                `    ${kw("Î‘Î½")} ${v("i")} ${sym("+")} ${v("j")} ${sym("<")} ${n("6")} ${kw("Î¤ÏŒÏ„Îµ")}`,
                `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
            ],
            6: [
                `${kw("Î“Î¹Î±")} ${v("i")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                `  ${kw("Î“Î¹Î±")} ${v("j")} ${kw("Î±Ï€ÏŒ")} ${n("1")} ${kw("Î¼Î­Ï‡ÏÎ¹")} ${n("5")}`,
                `    ${kw("Î‘Î½")} ${v("i")} ${sym("+")} ${v("j")} ${sym(">")} ${n("6")} ${kw("Î¤ÏŒÏ„Îµ")}`,
                `      ${kw("Î”Î¹Î¬Î²Î±ÏƒÎµ")} ${v("Î ")}${sym("[")}${v("i")}${sym(",")}${v("j")}${sym("]")}`,
                `    ${kw("Î¤Î­Î»Î¿Ï‚_Î±Î½")}`,
                `  ${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`,
                `${kw("Î¤Î­Î»Î¿Ï‚_ÎµÏ€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚")}`
            ]
        };
    }

    // --- Init ---
    function init() {
        renderGrid();
        
        isPlaying = false;
        clearTimeout(timer);
        stepIdx = -1;
        document.getElementById('outputLog').innerHTML = '';
        
        if (currentMode === 0) {
            clearAllStyles();
            document.getElementById('formulaBox').innerText = "-";
            document.getElementById('narrativeBox').innerText = "Î Î±Ï„Î®ÏƒÏ„Îµ Î­Î½Î± ÎºÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Ï€ÏÎ¿Î²Î¿Î»Î® Ï„Î·Ï‚ Î¹Î´Î¹ÏŒÏ„Î·Ï„Î±Ï‚.";
        } else {
            renderCode();
            document.getElementById('narrativeBox').innerText = "Î Î±Ï„Î®ÏƒÏ„Îµ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·...";
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
            updateFormula();
            calcSteps();
        }
    }

    function setMode(m) {
        currentMode = m;
        // Default to optimized when switching tabs, unless user toggles
        algoType = 'opt';
        updateAlgoButtons();

        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === m));
        
        const desc = document.getElementById('descText');
        const ovPanel = document.getElementById('overviewPanel');
        const codeContainer = document.getElementById('codeContainer');
        const simControls = document.getElementById('simControls');
        const algoToggle = document.getElementById('algoToggle');

        clearAllStyles();
        document.getElementById('outputLog').innerHTML = '';

        if(m === 0) {
            // Overview
            desc.innerText = "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î± ÎºÎµÎ»Î¹Î¬ ÎºÎ±Î¹ Ï„Î¿Î½ Ï„ÏÏ€Î¿.";
            ovPanel.style.display = 'grid'; 
            codeContainer.style.display = 'none';
            simControls.style.display = 'none';
            algoToggle.style.display = 'none';
            document.getElementById('narrativeBox').innerText = "Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Î¹Î´Î¹Î¿Ï„Î®Ï„Ï‰Î½.";
            document.getElementById('formulaBox').innerText = "Î•Ï€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·";
        } else {
            // Sim
            ovPanel.style.display = 'none';
            codeContainer.style.display = 'block';
            simControls.style.display = 'flex';
            
            // Show Algo Toggle only for 1-4
            if (m >= 1 && m <= 4) {
                algoToggle.style.display = 'flex';
            } else {
                algoToggle.style.display = 'none';
            }
            
            if(m===1) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: ÎšÏÏÎ¹Î± Î”Î¹Î±Î³ÏÎ½Î¹Î¿Ï‚";
            else if(m===2) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: Î”ÎµÏ…Ï„ÎµÏÎµÏÎ¿Ï…ÏƒÎ± Î”Î¹Î±Î³ÏÎ½Î¹Î¿Ï‚";
            else if(m===3) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: ÎšÎ¬Ï„Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿";
            else if(m===4) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: Î†Î½Ï‰ Î¤ÏÎ¯Î³Ï‰Î½Î¿";
            else if(m===5) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: Î Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î· 2Î· Î”Î¹Î±Î³ÏÎ½Î¹Î¿";
            else if(m===6) desc.innerText = "Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·: ÎšÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î· 2Î· Î”Î¹Î±Î³ÏÎ½Î¹Î¿";
            
            init();
        }
    }

    function setAlgo(type) {
        algoType = type;
        updateAlgoButtons();
        init();
    }

    function updateAlgoButtons() {
        document.getElementById('btnOpt').className = algoType === 'opt' ? 'toggle-btn active-algo' : 'toggle-btn';
        document.getElementById('btnBrute').className = algoType === 'brute' ? 'toggle-btn active-algo' : 'toggle-btn';
    }

    function updateFormula(text = null) {
        const f = document.getElementById('formulaBox');
        if (text) {
            f.innerText = text;
            return;
        }
        if(currentMode===1) f.innerText = "i = j";
        else if(currentMode===2) f.innerText = "i + j = 6";
        else if(currentMode===3) f.innerText = "i > j";
        else if(currentMode===4) f.innerText = "i < j";
        else if(currentMode===5) f.innerText = "i + j < 6";
        else if(currentMode===6) f.innerText = "i + j > 6";
    }

    // --- OVERVIEW FUNCTION ---
    function showOverview(type) {
        clearAllStyles();
        document.querySelectorAll('.ov-btn').forEach((b, i) => b.classList.toggle('active-btn', i === type-1));

        let formula = "";
        if(type === 1) formula = "i = j";
        else if(type === 2) formula = "i + j = 6";
        else if(type === 3) formula = "i > j";
        else if(type === 4) formula = "i < j";
        else if(type === 5) formula = "i + j < 6";
        else if(type === 6) formula = "i + j > 6";
        
        updateFormula(formula);
        document.getElementById('narrativeBox').innerText = `Î ÏÎ¿Î²Î¿Î»Î®: ${formula}`;

        for(let i=1; i<=N; i++) {
            for(let j=1; j<=N; j++) {
                let match = false;
                if(type === 1 && i === j) match = true;
                if(type === 2 && i + j === 6) match = true;
                if(type === 3 && i > j) match = true;
                if(type === 4 && i < j) match = true;
                if(type === 5 && i + j < 6) match = true;
                if(type === 6 && i + j > 6) match = true;

                if(match) {
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    cell.classList.add('selected');
                }
            }
        }

        if (type === 1) drawLine(1);
        if (type === 2) drawLine(2);
    }

    function drawLine(type) {
        const line = document.getElementById('diagLine');
        let startCell, endCell;

        if (type === 1) { // Main
            startCell = document.getElementById('cell-1-1');
            endCell = document.getElementById('cell-5-5');
        } else { // Sec
            startCell = document.getElementById('cell-1-5');
            endCell = document.getElementById('cell-5-1');
        }

        const x1 = startCell.offsetLeft + (startCell.offsetWidth / 2);
        const y1 = startCell.offsetTop + (startCell.offsetHeight / 2);
        const x2 = endCell.offsetLeft + (endCell.offsetWidth / 2);
        const y2 = endCell.offsetTop + (endCell.offsetHeight / 2);

        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        line.style.display = 'block';
    }

    function clearAllStyles() {
        document.querySelectorAll('.cell').forEach(c => {
            c.classList.remove('selected', 'selected-sim', 'scanning');
        });
        document.getElementById('diagLine').style.display = 'none';
        document.querySelectorAll('.ov-btn').forEach(b => b.classList.remove('active-btn'));
    }

    function toggleCode() {
        const p = document.querySelector('.col-code');
        p.classList.toggle('hidden');
        const btn = document.getElementById('btnCode');
        btn.innerText = p.classList.contains('hidden') ? "ğŸ‘ï¸ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±" : "ğŸ‘ï¸ Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· ÎšÏÎ´Î¹ÎºÎ±";
    }

    function renderCode() {
        if(currentMode === 0) return;
        let codeObj = (currentMode >= 5) ? getCodes56() : getCodes();
        let lines = codeObj[currentMode];
        const html = lines.map((l, i) => `<div class="code-line" id="line-${i}">${l}</div>`).join('');
        document.getElementById('codeContainer').innerHTML = html;
    }

    function renderGrid() {
        const container = document.getElementById('gridContainer');
        const svg = document.getElementById('svgOverlay');
        container.innerHTML = '';
        container.appendChild(svg);
        
        for(let i=1; i<=N; i++) {
            for(let j=1; j<=N; j++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}-${j}`;
                cell.innerHTML = `<span class="cell-coords">(${i},${j})</span>`;
                container.appendChild(cell);
            }
        }
    }

    // --- Logic (Sim) ---
    function calcSteps() {
        steps = [];
        
        if (currentMode === 1) { // MAIN DIAG
            if (algoType === 'opt') {
                for(let i=1; i<=N; i++) {
                    steps.push({ line: 0, type: 'scan', r: i, c: i, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: i=${i}` });
                    steps.push({ line: 1, type: 'found', r: i, c: i, msg: `  Î•Ï€Î¹Î»Î¿Î³Î® (${i},${i})` });
                    steps.push({ line: 2, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ Î•Ï€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚` });
                }
            } else { // Brute
                for(let i=1; i<=N; i++) {
                    for(let j=1; j<=N; j++) {
                        steps.push({ line: 2, type: 'scan', r: i, c: j, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ (${i},${j}): i=j ?` });
                        if(i===j) {
                            steps.push({ line: 3, type: 'found', r: i, c: j, msg: `  ÎÎ‘Î™ (${i}=${j})` });
                            steps.push({ line: 4, msg: `  Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                        } else {
                            steps.push({ line: 4, msg: `  ÎŸÎ§Î™` });
                        }
                    }
                }
            }
        } 
        else if (currentMode === 2) { // SEC DIAG
            if (algoType === 'opt') {
                for(let i=1; i<=N; i++) {
                    let j = 6 - i;
                    steps.push({ line: 0, type: 'scan', r: i, c: j, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: i=${i}` });
                    steps.push({ line: 1, msg: `  j <- 6 - ${i} = ${j}` });
                    steps.push({ line: 2, type: 'found', r: i, c: j, msg: `  Î•Ï€Î¹Î»Î¿Î³Î® (${i},${j})` });
                    steps.push({ line: 3, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ Î•Ï€Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚` });
                }
            } else { // Brute
                for(let i=1; i<=N; i++) {
                    for(let j=1; j<=N; j++) {
                        steps.push({ line: 2, type: 'scan', r: i, c: j, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ (${i},${j}): i+j=6 ?` });
                        if(i+j===6) {
                            steps.push({ line: 3, type: 'found', r: i, c: j, msg: `  ÎÎ‘Î™ (${i}+${j}=6)` });
                            steps.push({ line: 4, msg: `  Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                        } else {
                            steps.push({ line: 4, msg: `  ÎŸÎ§Î™` });
                        }
                    }
                }
            }
        }
        else if (currentMode === 3) { // LOWER
            if (algoType === 'opt') {
                for(let i=2; i<=N; i++) {
                    steps.push({ line: 0, msg: `Î“Î¹Î± i = ${i}` });
                    for(let j=1; j<i; j++) {
                        steps.push({ line: 1, type: 'scan', r: i, c: j, msg: `  Î“Î¹Î± j = ${j}` });
                        steps.push({ line: 2, type: 'found', r: i, c: j, msg: `    Î•Ï€Î¹Î»Î¿Î³Î® (${i},${j})` });
                        steps.push({ line: 3, type: 'loop_end', msg: `  Î¤Î­Î»Î¿Ï‚ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
                    }
                    steps.push({ line: 4, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
                }
            } else { // Brute
                for(let i=1; i<=N; i++) {
                    for(let j=1; j<=N; j++) {
                        steps.push({ line: 2, type: 'scan', r: i, c: j, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ (${i},${j}): i>j ?` });
                        if(i>j) {
                            steps.push({ line: 3, type: 'found', r: i, c: j, msg: `  ÎÎ‘Î™ (${i}>${j})` });
                            steps.push({ line: 4, msg: `  Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                        } else {
                            steps.push({ line: 4, msg: `  ÎŸÎ§Î™` });
                        }
                    }
                }
            }
        }
        else if (currentMode === 4) { // UPPER
            if (algoType === 'opt') {
                for(let i=1; i<N; i++) {
                    steps.push({ line: 0, msg: `Î“Î¹Î± i = ${i}` });
                    for(let j=i+1; j<=N; j++) {
                        steps.push({ line: 1, type: 'scan', r: i, c: j, msg: `  Î“Î¹Î± j = ${j}` });
                        steps.push({ line: 2, type: 'found', r: i, c: j, msg: `    Î•Ï€Î¹Î»Î¿Î³Î® (${i},${j})` });
                        steps.push({ line: 3, type: 'loop_end', msg: `  Î¤Î­Î»Î¿Ï‚ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
                    }
                    steps.push({ line: 4, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
                }
            } else { // Brute
                for(let i=1; i<=N; i++) {
                    for(let j=1; j<=N; j++) {
                        steps.push({ line: 2, type: 'scan', r: i, c: j, msg: `ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ (${i},${j}): i<j ?` });
                        if(i<j) {
                            steps.push({ line: 3, type: 'found', r: i, c: j, msg: `  ÎÎ‘Î™ (${i}<${j})` });
                            steps.push({ line: 4, msg: `  Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                        } else {
                            steps.push({ line: 4, msg: `  ÎŸÎ§Î™` });
                        }
                    }
                }
            }
        }
        else if (currentMode === 5) { // Above Sec
            for(let i=1; i<=N; i++) {
                steps.push({ line: 0, msg: `Î“Î¹Î± i = ${i}` });
                for(let j=1; j<=N; j++) {
                    steps.push({ line: 1, type: 'scan', r: i, c: j, msg: `  Î“Î¹Î± j = ${j}` });
                    steps.push({ line: 2, msg: `    ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: i+j < 6` });
                    if(i+j < 6) {
                        steps.push({ line: 3, type: 'found', r: i, c: j, msg: `      ÎÎ‘Î™` });
                        steps.push({ line: 4, type: 'loop_end', msg: `    Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                    } else {
                        steps.push({ line: 4, msg: `      ÎŸÎ§Î™` });
                    }
                }
                steps.push({ line: 6, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
            }
        }
        else if (currentMode === 6) { // Below Sec
            for(let i=1; i<=N; i++) {
                steps.push({ line: 0, msg: `Î“Î¹Î± i = ${i}` });
                for(let j=1; j<=N; j++) {
                    steps.push({ line: 1, type: 'scan', r: i, c: j, msg: `  Î“Î¹Î± j = ${j}` });
                    steps.push({ line: 2, msg: `    ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: i+j > 6` });
                    if(i+j > 6) {
                        steps.push({ line: 3, type: 'found', r: i, c: j, msg: `      ÎÎ‘Î™` });
                        steps.push({ line: 4, type: 'loop_end', msg: `    Î¤Î­Î»Î¿Ï‚_Î‘Î½` });
                    } else {
                        steps.push({ line: 4, msg: `      ÎŸÎ§Î™` });
                    }
                }
                steps.push({ line: 6, type: 'loop_end', msg: `Î¤Î­Î»Î¿Ï‚ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ®Ï‚` });
            }
        }
    }

    // --- Visuals ---
    function highlightLine(idx) {
        document.querySelectorAll('.code-line').forEach(l => l.classList.remove('active'));
        const el = document.getElementById(`line-${idx}`);
        if(el) el.classList.add('active');
    }

    function markScanning(r, c) {
        document.querySelectorAll('.scanning').forEach(e => e.classList.remove('scanning'));
        const cell = document.getElementById(`cell-${r}-${c}`);
        if(cell) cell.classList.add('scanning');
    }

    function markFound(r, c) {
        const cell = document.getElementById(`cell-${r}-${c}`);
        if(cell) {
            cell.classList.remove('scanning');
            cell.classList.add('selected-sim');
        }
        const log = document.getElementById('outputLog');
        log.innerHTML += `<div class="log-item">Î•Ï€Î¹Î»Î¿Î³Î®: (${r},${c})</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function narrate(msg) {
        document.getElementById('narrativeBox').innerText = msg;
    }

    // --- Execution ---
    function step() {
        if (currentMode === 0) return;
        if (stepIdx === -1 && steps.length === 0) calcSteps();
        if (stepIdx >= steps.length - 1) {
            isPlaying = false;
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
            document.querySelectorAll('.scanning').forEach(e => e.classList.remove('scanning'));
            return;
        }
        stepIdx++;
        runStep(steps[stepIdx]);
    }

    function runStep(s) {
        highlightLine(s.line);
        narrate(s.msg);

        if(s.type === 'scan') {
            markScanning(s.r, s.c);
        }
        else if(s.type === 'found') {
            markFound(s.r, s.c);
        }

        if (isPlaying) timer = setTimeout(step, speed);
    }

    function play() {
        if (currentMode === 0) return;
        if (!isPlaying) {
            isPlaying = true;
            document.getElementById('btnPlay').innerText = "â¸ Î Î±ÏÏƒÎ·";
            if(stepIdx === -1) calcSteps();
            step();
        } else {
            isPlaying = false;
            clearTimeout(timer);
            document.getElementById('btnPlay').innerText = "â–¶ï¸ Î•ÎºÏ„Î­Î»ÎµÏƒÎ·";
        }
    }

    function updateSpeed() {
        speed = 2200 - document.getElementById('speedSlider').value;
    }

    init();

</script>
</body>
</html>